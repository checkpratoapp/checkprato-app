<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>CheckPrato ‚Ä¢ Elite</title>

  <meta name="theme-color" content="#0a1320"/>
  <link rel="manifest" href="./manifest.json">
  <link rel="icon" sizes="192x192" href="./icon-192.png">
  <link rel="apple-touch-icon" href="./icon-192.png">

  <!-- Chart.js (Evolu√ß√£o) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <style>
    :root{
      --bg:#07121f;
      --bg2:#0b2033;
      --card:rgba(255,255,255,.04);
      --card2:rgba(255,255,255,.06);
      --stroke:rgba(255,255,255,.08);
      --txt:#eaf2ff;
      --muted:rgba(234,242,255,.72);
      --green:#21e6b6;
      --green2:#17caa0;
      --orange:#f6b23a;
      --shadow:0 20px 60px rgba(0,0,0,.45);
      --r:22px;
      --max:560px;

      --stroke3d: rgba(255,255,255,.10);
      --shadow3d: 0 24px 70px rgba(0,0,0,.55);
    }

    *{ box-sizing:border-box; }
    html, body{
      height:100%;
      margin:0;
      padding:0;
      background: var(--bg);
      color: var(--txt);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      overflow-x:hidden;
    }
    body{ padding-bottom: calc(92px + env(safe-area-inset-bottom)); }
    a{ color: var(--green); text-decoration:none; }
    a:hover{ text-decoration:underline; }

    .wrap{ max-width: var(--max); margin: 0 auto; padding: 16px 14px 24px; }

    .topbar{
      display:flex; align-items:center; gap:12px;
      margin-top:6px; margin-bottom: 14px;
    }
    .logo{
      width:44px;height:44px;border-radius:14px;
      background: linear-gradient(135deg, rgba(33,230,182,.35), rgba(33,230,182,.05));
      border:1px solid rgba(33,230,182,.35);
      display:flex;align-items:center;justify-content:center;
      font-weight:1000;
      color:var(--green);
      box-shadow: var(--shadow);
      flex:0 0 auto;
    }
    .brand{ display:flex; flex-direction:column; gap:2px; min-width:0; flex:1 1 auto; }
    .brand small{ color:var(--muted); letter-spacing:.08em; font-weight:900}
    .brand b{ font-size:18px }

    .pill{
      display:flex;align-items:center;gap:8px;
      padding:10px 12px;border-radius:999px;
      background: rgba(255,255,255,.04);
      border:1px solid var(--stroke);
      color:var(--muted);
      font-weight:800;
      white-space:nowrap;
      flex:0 0 auto;
    }
    .pill .dot{
      width:10px;height:10px;border-radius:99px;background:var(--green);
      box-shadow: 0 0 0 6px rgba(33,230,182,.12);
    }

    .h1{
      font-size:34px;
      margin:12px 2px 14px;
      letter-spacing:.02em;
      color:var(--green);
      font-weight: 1000;
      line-height: 1.05;
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.03));
      border: 1px solid var(--stroke);
      border-radius: var(--r);
      padding: 16px;
      box-shadow: var(--shadow);
    }

    .hint{ color: var(--muted); font-weight: 650; line-height: 1.35; }
    .muted{ opacity:.85; }

    .row{display:flex; gap:12px; flex-wrap:wrap}
    .col{flex:1 1 140px; min-width: 140px}

    .label{
      margin: 12px 2px 6px;
      color: rgba(234,242,255,.65);
      font-weight: 950;
      letter-spacing:.12em;
      text-transform: uppercase;
      font-size: 12px;
    }

    input, select, textarea{
      width:100%;
      padding:14px 14px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      color: var(--txt);
      outline: none;
      font-size: 15px;
    }
    textarea{ min-height: 90px; resize: vertical; }
    input::placeholder{color: rgba(234,242,255,.35)}
    select{appearance:none}

    .btn{
      width:100%;
      padding: 16px 16px;
      border-radius: 18px;
      border: 0;
      cursor: pointer;
      font-weight: 950;
      font-size: 16px;
      letter-spacing: .02em;
      background: linear-gradient(135deg, var(--green), var(--green2));
      color:#042019;
      box-shadow: 0 18px 45px rgba(33,230,182,.18);
      margin-top: 14px;
    }
    .btnSecondary{
      width:100%;
      padding: 14px 16px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.10);
      cursor: pointer;
      font-weight: 900;
      font-size: 15px;
      background: rgba(255,255,255,.05);
      color: var(--txt);
      margin-top: 10px;
    }

    .status{
      margin-top: 10px;
      font-weight: 800;
      color: rgba(234,242,255,.86);
    }

    .chips{display:flex; flex-wrap:wrap; gap:10px; margin-top:10px;}
    .chip{
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      color: var(--muted);
      font-weight: 900;
      cursor: pointer;
      user-select: none;
    }
    .chip.on{
      border-color: rgba(33,230,182,.45);
      background: rgba(33,230,182,.12);
      color: var(--txt);
      box-shadow: 0 0 0 6px rgba(33,230,182,.08);
    }

    .screen{ display:none; margin-top: 8px; width: 100%; background: var(--bg); padding-bottom: calc(140px + env(safe-area-inset-bottom)); }
    .screen.active{ display:block; }

    /* NAV */
    .nav{
      position: fixed;
      left:0; right:0; bottom:0;
      padding: 10px 10px calc(10px + env(safe-area-inset-bottom));
      background: #07121f;
      border-top: 1px solid rgba(255,255,255,.08);
      z-index: 1000;
    }
    .navInner{
      max-width: var(--max);
      margin: 0 auto;
      display:flex;
      gap:10px;
      overflow-x: auto;
      padding: 6px 6px;
      scrollbar-width: none;
    }
    .navInner::-webkit-scrollbar{ display:none; }
    .navBtn{
      flex:0 0 auto;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
      color: rgba(234,242,255,.6);
      font-weight: 950;
      padding: 12px 14px;
      border-radius: 999px;
      cursor:pointer;
      letter-spacing:.05em;
      white-space: nowrap;
    }
    .navBtn.active{
      background: rgba(33,230,182,.12);
      border-color: rgba(33,230,182,.35);
      color: var(--green);
      box-shadow: 0 0 0 6px rgba(33,230,182,.08);
    }

    /* TOP BTN */
    #btnTop{
      position:fixed;
      bottom:110px;
      right:18px;
      width:48px;
      height:48px;
      border-radius:50%;
      border:none;
      background:linear-gradient(135deg,#21e6b6,#17caa0);
      color:#042019;
      font-size:22px;
      font-weight:900;
      box-shadow:0 10px 25px rgba(0,0,0,.4);
      display:none;
      z-index:999;
      cursor:pointer;
    }

    /* WELCOME */
    .welcomeHero{
      border-radius: 26px;
      border: 1px solid rgba(255,255,255,.10);
      background:
        radial-gradient(700px 280px at 20% 10%, rgba(33,230,182,.18), transparent 60%),
        radial-gradient(600px 260px at 80% 30%, rgba(246,178,58,.14), transparent 62%),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      box-shadow: 0 22px 70px rgba(0,0,0,.55);
      padding: 16px;
      overflow:hidden;
    }
    .wCarousel{
      position: relative;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      overflow: hidden;
      min-height: 270px;
      margin-top:12px;
    }
    .wSlide{ display:none; padding: 18px 16px 16px; min-height: 270px; position: relative; }
    .wSlide.active{ display:block; }
    .wBg{
      position:absolute; inset:0;
      opacity:.9;
      background:
        radial-gradient(900px 340px at 20% 20%, rgba(33,230,182,.22), transparent 60%),
        radial-gradient(800px 360px at 80% 30%, rgba(246,178,58,.16), transparent 62%),
        radial-gradient(700px 380px at 45% 110%, rgba(33,230,182,.10), transparent 62%);
      pointer-events:none;
    }
    .wTop{ position:relative; display:flex; align-items:center; justify-content:space-between; gap:10px; z-index:1; }
    .wBadge{
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 12px; border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      color: rgba(234,242,255,.78);
      font-weight: 950;
      letter-spacing:.06em;
      text-transform: uppercase;
      font-size: 12px;
    }
    .wDots{ display:flex; gap:8px; align-items:center; }
    .wDot{
      width:10px;height:10px;border-radius:99px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      cursor:pointer;
    }
    .wDot.on{
      background: rgba(33,230,182,.40);
      border-color: rgba(33,230,182,.55);
      box-shadow: 0 0 0 6px rgba(33,230,182,.10);
    }
    .wTitle{ position:relative; z-index:1; margin-top: 14px; font-size: 26px; font-weight: 1000; line-height: 1.1; }
    .wText{ position:relative; z-index:1; margin-top: 10px; color: rgba(234,242,255,.85); font-weight: 750; line-height: 1.45; }
    .wQuote{
      position:relative; z-index:1;
      margin-top: 12px; padding: 12px 12px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      color: rgba(234,242,255,.88);
      font-weight: 850;
    }
    .wNavRow{ display:flex; gap:10px; flex-wrap:wrap; margin-top: 14px; }

    /* PRATO */
    .platePreview{
      width:100%;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.14);
      overflow:hidden;
      margin-top: 12px;
      display:none;
    }
    .platePreview img{ width:100%; display:block; }
    .miniRow{ display:flex; gap:10px; flex-wrap:wrap }
    .miniBtn{
      flex:1 1 160px;
      padding:14px 14px;
      border-radius:18px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      color: var(--txt);
      font-weight: 900;
      cursor:pointer;
    }
    .scorePill{
      display:inline-flex; align-items:center; justify-content:center;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid rgba(33,230,182,.25);
      background: rgba(33,230,182,.08);
      color: var(--green);
      font-weight: 1000;
      margin-top:10px;
    }

    /* CARDS LIST */
    .meal{
      display:flex; justify-content:space-between; gap:12px;
      padding: 16px;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
      margin-top: 12px;
    }
    .meal .title{
      font-weight: 950;
      color: var(--green);
      letter-spacing:.08em;
      text-transform: uppercase;
      font-size: 12px;
      margin-bottom: 6px;
    }
    .meal p{margin:0; color: rgba(234,242,255,.88); font-weight:750; line-height:1.35}
    .kcal{
      display:flex; align-items:center; justify-content:center;
      min-width: 92px;
      border-radius: 999px;
      border:1px solid rgba(246,178,58,.25);
      background: rgba(246,178,58,.10);
      color: #ffd38a;
      font-weight: 1000;
      padding: 10px 12px;
      text-align:center;
    }

    /* TREINO */
    .dayCard{
      margin-top: 12px;
      padding: 14px;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
    }
    .dayTitle{
      display:flex; align-items:center; justify-content:space-between;
      font-weight: 1000;
      color: rgba(234,242,255,.92);
      margin-bottom: 10px;
      letter-spacing:.03em;
    }
    .exercise{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
      padding: 12px 12px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.16);
      margin-top: 10px;
    }
    .ytBtn{
      border:0;
      border-radius: 999px;
      padding: 10px 12px;
      background: rgba(33,230,182,.10);
      border: 1px solid rgba(33,230,182,.25);
      color: var(--green);
      font-weight: 1000;
      cursor: pointer;
      min-width: 110px;
    }

    /* PARCEIROS */
    .partnerList{display:flex; flex-direction:column; gap:12px; margin-top:12px}
    .partnerRow{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:14px; border-radius:18px;
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.06);
    }
    .partnerName{display:flex; flex-direction:column; gap:4px}
    .partnerName b{font-weight: 1000}

    /* 3D DASH */
    .pro3dWrap{ perspective: 1200px; }
    .pro3dCard{
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
      border: 1px solid var(--stroke3d);
      border-radius: 26px;
      box-shadow: var(--shadow3d);
      transform: rotateX(7deg) rotateY(-6deg);
      transform-style: preserve-3d;
      overflow:hidden;
      position: relative;
    }
    .pro3dCard:before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(600px 260px at 20% 10%, rgba(33,230,182,.18), transparent 60%),
        radial-gradient(520px 260px at 80% 30%, rgba(246,178,58,.14), transparent 60%),
        radial-gradient(700px 340px at 40% 100%, rgba(33,230,182,.10), transparent 62%);
      pointer-events:none;
    }
    .proTop{ display:flex; align-items:center; justify-content:space-between; padding:16px 16px 0; position: relative; z-index: 1; }
    .proTitle{
      font-size: 26px;
      font-weight: 1000;
      letter-spacing: .02em;
      margin: 10px 16px 12px;
      color: rgba(234,242,255,.95);
      position: relative; z-index: 1;
    }
    .proGrid{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap: 12px;
      padding: 0 16px 16px;
      position: relative; z-index: 1;
    }
    .proPanel{
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      backdrop-filter: blur(10px);
      padding: 14px;
      transform: translateZ(18px);
    }
    .proRingBox{ display:flex; flex-direction:column; align-items:center; justify-content:center; gap: 10px; min-height: 240px; }
    .ring{ width: 180px; height: 180px; position: relative; transform: translateZ(26px); }
    .ring svg{ width: 100%; height: 100%; transform: rotate(-90deg); filter: drop-shadow(0 20px 40px rgba(0,0,0,.55)); }
    .ringCenter{
      position:absolute; inset: 0;
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      text-align:center; gap: 2px;
    }
    .ringPct{ font-size: 44px; font-weight: 1000; color: #ffd38a; text-shadow: 0 10px 30px rgba(0,0,0,.45); }
    .ringSub{ color: rgba(234,242,255,.72); font-weight: 900; }
    .proStats{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
      padding: 0 16px 16px;
      position: relative; z-index: 1;
    }
    .stat3d{
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.16);
      padding: 12px;
      transform: translateZ(14px);
    }
    .stat3d .num{ font-size: 24px; font-weight: 1000; color: rgba(234,242,255,.95); }
    .stat3d .lab{
      margin-top: 2px;
      color: rgba(234,242,255,.65);
      font-weight: 850;
      font-size: 12px;
      letter-spacing:.08em;
      text-transform: uppercase;
    }
    .chartBox{
      margin-top: 12px;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.14);
      padding: 12px;
      overflow:hidden;
    }

    @media (min-width: 900px){
      .wrap{ max-width: 900px; }
      .proGrid{ grid-template-columns: 1fr 1fr; }
      .ring{ width: 210px; height: 210px; }
      .pro3dCard{ transform: rotateX(6deg) rotateY(-4deg); }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="logo">E</div>
      <div class="brand">
        <small>ELITE TERMINAL</small>
        <b>CheckPrato ‚Ä¢ Elite</b>
      </div>
      <div class="pill"><span class="dot"></span><span id="authTxt">Modo: Local</span></div>
    </div>

    <!-- BOAS-VINDAS -->
    <section id="viewWelcome" class="screen active">
      <div class="h1">Bem-vindo</div>
      <div class="welcomeHero">
        <div class="hint">
          Voc√™ n√£o precisa ‚Äúfor√ßa‚Äù. Precisa de <b>controle</b>, <b>clareza</b> e <b>const√¢ncia</b>.
        </div>

        <div class="wCarousel">
          <div class="wSlide active" data-slide="0">
            <div class="wBg"></div>
            <div class="wTop">
              <div class="wBadge">üî• Consist√™ncia</div>
              <div class="wDots" id="wDots"></div>
            </div>
            <div class="wTitle">Pequenas escolhas<br>mudam tudo.</div>
            <div class="wText">Hoje voc√™ faz o b√°sico. Amanh√£ voc√™ colhe o resultado.</div>
            <div class="wQuote">‚ÄúDisciplina √© quando ningu√©m t√° olhando.‚Äù</div>
          </div>

          <div class="wSlide" data-slide="1">
            <div class="wBg"></div>
            <div class="wTop">
              <div class="wBadge">ü•ó Prato</div>
              <div class="wDots"></div>
            </div>
            <div class="wTitle">Controle sem neura.</div>
            <div class="wText">Pontue seu prato e enxergue padr√µes ao longo da semana.</div>
            <div class="wQuote">‚ÄúO que √© medido, melhora.‚Äù</div>
          </div>

          <div class="wSlide" data-slide="2">
            <div class="wBg"></div>
            <div class="wTop">
              <div class="wBadge">üèãÔ∏è Treino</div>
              <div class="wDots"></div>
            </div>
            <div class="wTitle">Treino inteligente.</div>
            <div class="wText">Adaptado ao seu n√≠vel, esporte e condi√ß√£o.</div>
            <div class="wQuote">‚ÄúForte √© quem n√£o para.‚Äù</div>
          </div>

          <div class="wSlide" data-slide="3">
            <div class="wBg"></div>
            <div class="wTop">
              <div class="wBadge">üìà Evolu√ß√£o</div>
              <div class="wDots"></div>
            </div>
            <div class="wTitle">Evolu√ß√£o vis√≠vel.</div>
            <div class="wText">Gr√°fico, streak, medalhas e ranking semanal.</div>
            <div class="wQuote">‚ÄúVoc√™ contra voc√™.‚Äù</div>
          </div>
        </div>

        <div class="wNavRow">
          <button class="btn" type="button" onclick="goCadastro()">Come√ßar agora</button>
          <button class="btnSecondary" type="button" onclick="goManual()">Ver manual</button>
        </div>
      </div>
    </section>

    <!-- MANUAL -->
    <section id="viewManual" class="screen">
      <div class="h1">Manual</div>
      <div class="card">
        <div class="label">Como usar</div>
        <div class="hint">
          1) Fa√ßa seu <b>Cadastro</b>.<br>
          2) Registre o <b>Prato</b> e acompanhe sua pontua√ß√£o.<br>
          3) Gere sua <b>Dieta</b> e <b>Treino</b> conforme perfil.<br>
          4) Veja <b>Evolu√ß√£o</b> e mantenha sua const√¢ncia.<br>
        </div>

        <div class="label" style="margin-top:14px">D√∫vidas r√°pidas</div>

        <div class="card" style="margin-top:10px; background:rgba(255,255,255,.03)">
          <div class="label" style="margin-top:0">Metas</div>
          <div class="hint">Defina metas realistas e melhore 1% por dia.</div>
        </div>

        <div class="card" style="margin-top:10px; background:rgba(255,255,255,.03)">
          <div class="label" style="margin-top:0">Pontua√ß√£o do prato</div>
          <div class="hint">A pontua√ß√£o serve pra voc√™ criar padr√£o. O foco √© consist√™ncia, n√£o perfei√ß√£o.</div>
        </div>

        <button class="btn" type="button" onclick="goCadastro()">Ir para Cadastro</button>
      </div>
    </section>

    <!-- CADASTRO -->
    <section id="viewCadastro" class="screen">
      <div class="h1">Cadastro</div>
      <div class="card">
        <div class="row">
          <div class="col">
            <div class="label">Nome</div>
            <input id="nome" placeholder="Seu nome" />
          </div>
          <div class="col">
            <div class="label">Objetivo</div>
            <select id="objetivo">
              <option value="">Selecione</option>
              <option>Emagrecer</option>
              <option>Hipertrofia</option>
              <option>Sa√∫de</option>
              <option>Performance</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div class="col">
            <div class="label">Restri√ß√£o (sa√∫de)</div>
            <select id="restricao">
              <option>Nenhuma</option>
              <option>Diabetes</option>
              <option>Hipertens√£o</option>
              <option>Colesterol alto</option>
              <option>Intoler√¢ncia √† lactose</option>
              <option>Gl√∫ten</option>
              <option>Vegetariano</option>
              <option>Vegano</option>
            </select>
          </div>
          <div class="col">
            <div class="label">PCD / Dificuldade</div>
            <select id="pcd">
              <option>N√£o</option>
              <option>Mobilidade reduzida</option>
              <option>Idoso</option>
              <option>Les√£o / dor</option>
              <option>Obesidade (baixo impacto)</option>
              <option>Visual</option>
              <option>Auditiva</option>
            </select>
          </div>
        </div>

        <div class="label">Esportes (marque v√°rios)</div>
        <div id="chipsEsportes" class="chips"></div>

        <button class="btn" type="button" onclick="salvarCadastro()">Salvar cadastro</button>
        <button class="btnSecondary" type="button" onclick="limparCadastro()">Limpar</button>

        <div id="outCadastro" class="status" style="display:none"></div>
      </div>
    </section>

    <!-- PERFIL -->
    <section id="viewPerfil" class="screen">
      <div class="h1">Perfil</div>
      <div class="card">
        <div class="hint">Seus dados e status.</div>
        <div id="perfilBox" class="status" style="margin-top:12px">‚Äî</div>
        <button class="btnSecondary" type="button" onclick="resetAll()">Resetar dados do app</button>
      </div>
    </section>

    <!-- PRATO -->
    <section id="viewPrato" class="screen">
      <div class="h1">Prato</div>

      <div class="card">
        <div class="hint">Registre seu prato (foto ou descri√ß√£o). A pontua√ß√£o ajuda a criar padr√£o na semana.</div>

        <div class="miniRow" style="margin-top:12px">
          <button class="miniBtn" type="button" id="btnCamera">Tirar foto</button>
          <button class="miniBtn" type="button" id="btnGaleria">Escolher da galeria</button>
        </div>

        <input id="fileCamera" type="file" accept="image/*" capture="environment" style="display:none">
        <input id="fileGaleria" type="file" accept="image/*" style="display:none">

        <div class="platePreview" id="platePreview">
          <img id="plateImg" alt="Prato"/>
        </div>

        <div class="label">Descri√ß√£o do prato</div>
        <input id="plateDesc" placeholder="Ex: arroz, feij√£o, frango e salada" />

        <div class="row">
          <div class="col">
            <div class="label">Por√ß√£o</div>
            <select id="platePortion">
              <option>Pequena</option>
              <option selected>M√©dia</option>
              <option>Grande</option>
            </select>
          </div>
          <div class="col">
            <div class="label">Qualidade</div>
            <select id="plateQuality">
              <option>Ruim</option>
              <option>M√©dia</option>
              <option selected>Boa</option>
              <option>Excelente</option>
            </select>
          </div>
        </div>

        <button class="btn" type="button" onclick="avaliarPrato()">Registrar e pontuar</button>
        <div id="plateScore" class="scorePill" style="display:none"></div>

        <div class="label" style="margin-top:14px">Hist√≥rico da semana</div>
        <div id="plateHistory" class="hint">‚Äî</div>
      </div>
    </section>

    <!-- DIETA -->
    <section id="viewDieta" class="screen">
      <div class="h1">Dieta</div>

      <div class="card">
        <div class="hint">Escolha um estilo e gere uma rotina completa. O app varia automaticamente.</div>

        <div class="row" style="margin-top:10px">
          <div class="col">
            <div class="label">Tipo</div>
            <select id="tipoDieta">
              <option>Emagrecimento</option>
              <option>Hipertrofia</option>
              <option>Performance</option>
              <option>Low carb</option>
              <option>Econ√¥mica</option>
              <option>Vegetariana</option>
              <option>Vegana</option>
              <option>Diabetes</option>
              <option>Hipertens√£o</option>
              <option>Sem lactose</option>
              <option>Sem gl√∫ten</option>
            </select>
          </div>
          <div class="col">
            <div class="label">Prefer√™ncia</div>
            <select id="prefDieta">
              <option>Brasil (comida normal)</option>
              <option>Fit</option>
              <option>R√°pida (pouco tempo)</option>
            </select>
          </div>
        </div>

        <button class="btn" type="button" onclick="gerarDieta()">Gerar dieta</button>
        <button class="btnSecondary" type="button" onclick="gerarDieta(true)">Trocar</button>

        <div id="dietaBox"></div>
      </div>
    </section>

    <!-- TREINO -->
    <section id="viewTreino" class="screen">
      <div class="h1">Treino</div>

      <div class="card">
        <div class="hint">Treino semanal adaptado por esporte, n√≠vel e condi√ß√£o.</div>

        <div class="row" style="margin-top:10px">
          <div class="col">
            <div class="label">Esporte</div>
            <select id="temaTreino"></select>
          </div>
          <div class="col">
            <div class="label">Intensidade</div>
            <select id="intTreino">
              <option>Leve</option>
              <option selected>Moderado</option>
              <option>Pesado</option>
            </select>
          </div>
        </div>

        <button class="btn" type="button" onclick="gerarTreino()">Gerar treino da semana</button>
        <button class="btnSecondary" type="button" onclick="limparTreino()">Limpar</button>

        <div id="outTreino" class="status" style="display:none"></div>
        <div id="treinoSemana"></div>
      </div>
    </section>

    <!-- EVOLU√á√ÉO -->
    <section id="viewEvolucao" class="screen">
      <div class="h1">Evolu√ß√£o</div>

      <div class="card">
        <div class="hint">Acompanhe sua const√¢ncia: streak, medalhas, pontua√ß√£o semanal e gr√°fico.</div>

        <div class="row" style="margin-top:10px">
          <div class="col">
            <div class="label">Streak</div>
            <div class="pill"><span class="dot"></span><span id="streakTxt">0 dias</span></div>
          </div>
          <div class="col">
            <div class="label">N√≠vel</div>
            <div class="pill"><span class="dot"></span><span id="levelTxt">N√≠vel 1</span></div>
          </div>
        </div>

        <div class="label" style="margin-top:12px">Medalhas</div>
        <div id="badges" class="chips"></div>

        <div class="chartBox">
          <canvas id="evoChart" height="140"></canvas>
        </div>

        <div class="label">Registro r√°pido</div>
        <div class="miniRow">
          <button class="miniBtn" type="button" onclick="logEvo('treino')">Marcar treino feito</button>
          <button class="miniBtn" type="button" onclick="logEvo('prato')">Marcar prato saud√°vel</button>
        </div>

        <div class="hint" style="margin-top:10px" id="evoHint">‚Äî</div>
      </div>
    </section>

    <!-- PROGRESSO -->
    <section id="viewProgresso" class="screen">
      <div class="h1">Progresso</div>

      <div class="pro3dWrap">
        <div class="pro3dCard">
          <div class="proTop">
            <div class="pill"><span class="dot"></span><span id="proWeek">Semana</span></div>
            <div class="pill"><span class="dot"></span><span id="proMode">Local</span></div>
          </div>

          <div class="proTitle">Meta da Semana</div>

          <div class="proGrid">
            <div class="proPanel">
              <div class="label" style="margin-top:0">Progresso</div>

              <div class="proRingBox">
                <div class="ring">
                  <svg viewBox="0 0 120 120">
                    <circle cx="60" cy="60" r="48" stroke="rgba(255,255,255,.10)" stroke-width="10" fill="none"/>
                    <circle id="ringProg" cx="60" cy="60" r="48"
                      stroke="rgba(255,211,138,.95)" stroke-linecap="round"
                      stroke-width="10" fill="none"
                      stroke-dasharray="301.59" stroke-dashoffset="301.59"/>
                  </svg>
                  <div class="ringCenter">
                    <div class="ringPct" id="proPct">0%</div>
                    <div class="ringSub"><span id="proDone">0</span> / <span id="proGoal">5</span> dias</div>
                  </div>
                </div>

                <div class="miniRow" style="margin-top:6px">
                  <button class="miniBtn" type="button" onclick="addTreinoDone()">+1 treino</button>
                  <button class="miniBtn" type="button" onclick="setGoalDaysPrompt()">Meta</button>
                </div>
              </div>
            </div>

            <div class="proPanel">
              <div class="label" style="margin-top:0">Resumo</div>
              <div class="hint" id="proResumo">‚Äî</div>

              <div class="label" style="margin-top:12px">A√ß√µes</div>
              <button class="btnSecondary" type="button" onclick="resetProgresso()">Reset semana</button>
            </div>
          </div>

          <div class="proStats">
            <div class="stat3d">
              <div class="num" id="proKcal">0</div>
              <div class="lab">energia</div>
              <button class="btnSecondary" type="button" onclick="addKcal()">+1</button>
            </div>
            <div class="stat3d">
              <div class="num" id="proKm">0</div>
              <div class="lab">movimento</div>
              <button class="btnSecondary" type="button" onclick="addKm()">+1</button>
            </div>
            <div class="stat3d">
              <div class="num"><span id="proDays">0</span>/<span id="proDaysGoal">5</span></div>
              <div class="lab">treinos</div>
              <button class="btnSecondary" type="button" onclick="addTreinoDone()">+1</button>
            </div>
          </div>

        </div>
      </div>
    </section>

    <!-- SA√öDE -->
    <section id="viewSaude" class="screen">
      <div class="h1">Sa√∫de</div>

      <div class="card">
        <div class="hint">T√≥picos e orienta√ß√µes gerais. Clique para ler em fonte oficial.</div>

        <div class="miniRow" style="margin-top:12px">
          <button class="miniBtn" type="button" onclick="openSaude('diabetes')">Diabetes</button>
          <button class="miniBtn" type="button" onclick="openSaude('hipertensao')">Hipertens√£o</button>
          <button class="miniBtn" type="button" onclick="openSaude('colesterol')">Colesterol</button>
          <button class="miniBtn" type="button" onclick="openSaude('obesidade')">Obesidade</button>
          <button class="miniBtn" type="button" onclick="openSaude('sono')">Sono</button>
          <button class="miniBtn" type="button" onclick="openSaude('saude-mental')">Sa√∫de mental</button>
          <button class="miniBtn" type="button" onclick="openSaude('atividade-fisica')">Atividade f√≠sica</button>
          <button class="miniBtn" type="button" onclick="openSaude('anabolizantes')">Anabolizantes</button>
        </div>

        <div class="hint" style="margin-top:12px">Fontes: Minist√©rio da Sa√∫de / Biblioteca Virtual em Sa√∫de.</div>
      </div>
    </section>

    <!-- PARCEIROS -->
    <section id="viewParceiros" class="screen">
      <div class="h1">Parceiros</div>

      <div class="card">
        <div class="hint">Links oficiais.</div>

        <div class="partnerList">
          <div class="partnerRow">
            <div class="partnerName"><b>Growth Supplements</b><div class="muted">Whey, creatina e suplementos</div></div>
            <button class="btnSecondary" type="button" onclick="abrirLink('https://www.gsuplementos.com.br')">Abrir</button>
          </div>
          <div class="partnerRow">
            <div class="partnerName"><b>Max Titanium</b><div class="muted">Nutri√ß√£o esportiva</div></div>
            <button class="btnSecondary" type="button" onclick="abrirLink('https://www.maxtitanium.com.br')">Abrir</button>
          </div>
          <div class="partnerRow">
            <div class="partnerName"><b>Nike</b><div class="muted">T√™nis e roupas</div></div>
            <button class="btnSecondary" type="button" onclick="abrirLink('https://www.nike.com.br')">Abrir</button>
          </div>
          <div class="partnerRow">
            <div class="partnerName"><b>Adidas</b><div class="muted">Performance e lifestyle</div></div>
            <button class="btnSecondary" type="button" onclick="abrirLink('https://www.adidas.com.br')">Abrir</button>
          </div>
        </div>
      </div>
    </section>

    <!-- CONVITES -->
    <section id="viewConvites" class="screen">
      <div class="h1">Convites</div>

      <div class="card">
        <div class="hint">Compartilhe seu link.</div>

        <div class="card" style="margin-top:12px; background:rgba(255,255,255,.03)">
          <div class="label">Seu c√≥digo</div>
          <div id="myCode" style="font-weight:1000; font-size:18px">‚Äî</div>

          <div class="label" style="margin-top:12px">Seu link</div>
          <div id="myLink" class="muted" style="word-break:break-all">‚Äî</div>

          <div class="miniRow" style="margin-top:12px">
            <button class="miniBtn" type="button" onclick="copyInviteLink()">Copiar link</button>
            <button class="miniBtn" type="button" onclick="shareInvite()">Compartilhar</button>
          </div>
        </div>
      </div>
    </section>

  </div>

  <!-- NAV (ordem pedida) -->
  <div class="nav" id="navBar">
    <div class="navInner">
      <button class="navBtn active" data-view="viewWelcome" type="button">IN√çCIO</button>
      <button class="navBtn" data-view="viewManual" type="button">MANUAL</button>
      <button class="navBtn" data-view="viewCadastro" type="button">CADASTRO</button>
      <button class="navBtn" data-view="viewPerfil" type="button">PERFIL</button>
      <button class="navBtn" data-view="viewPrato" type="button">PRATO</button>
      <button class="navBtn" data-view="viewDieta" type="button">DIETA</button>
      <button class="navBtn" data-view="viewTreino" type="button">TREINO</button>
      <button class="navBtn" data-view="viewEvolucao" type="button">EVOLU√á√ÉO</button>
      <button class="navBtn" data-view="viewProgresso" type="button">PROGRESSO</button>
      <button class="navBtn" data-view="viewSaude" type="button">SA√öDE</button>
      <button class="navBtn" data-view="viewParceiros" type="button">PARCEIROS</button>
      <button class="navBtn" data-view="viewConvites" type="button">CONVITES</button>
    </div>
  </div>

  <button id="btnTop" onclick="scrollToTop()">‚Üë</button>

  <script>
    /***********************
     * Helpers
     ***********************/
    const $ = (id)=>document.getElementById(id);
    function abrirLink(url){ window.open(url, "_blank"); }
    function escapeHtml(s){
      return String(s).replace(/[&<>"]/g, m => ({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;" }[m]));
    }

    /***********************
     * Navega√ß√£o (SEM depender de event)
     ***********************/
    function showView(viewId){
      document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
      const el = document.getElementById(viewId);
      if(el) el.classList.add("active");

      document.querySelectorAll(".navBtn").forEach(b=>b.classList.remove("active"));
      const btn = document.querySelector(`.navBtn[data-view="${viewId}"]`);
      if(btn) btn.classList.add("active");

      scrollToTop();
      updateTopBtn();
    }
    window.showView = showView;

    function wireNav(){
      document.querySelectorAll(".navBtn").forEach(btn=>{
        btn.addEventListener("click", ()=> showView(btn.dataset.view));
      });
    }

    function scrollToTop(){ window.scrollTo({ top:0, behavior:"smooth" }); }
    window.scrollToTop = scrollToTop;

    function updateTopBtn(){
      const btn = $("btnTop");
      if(!btn) return;
      btn.style.display = (window.scrollY > 200) ? "block" : "none";
    }
    window.addEventListener("scroll", updateTopBtn, { passive:true });

    function goCadastro(){ showView("viewCadastro"); }
    function goManual(){ showView("viewManual"); }
    window.goCadastro = goCadastro;
    window.goManual = goManual;

    /***********************
     * Storage
     ***********************/
    const KEY_PROFILE = "cp_profile_v2";
    const KEY_PLATE_WEEK = "cp_plate_week_v1";
    const KEY_DIETA = "cp_dieta_v2";
    const KEY_TREINO = "cp_treino_v2";
    const KEY_DASH = "cp_dash_v2";
    const KEY_EVO = "cp_evo_v1";
    const KEY_INV = "cp_inv_v1";

    function safeJSON(key){
      try{ return JSON.parse(localStorage.getItem(key) || "null"); }catch{ return null; }
    }
    function setJSON(key, val){ localStorage.setItem(key, JSON.stringify(val)); }

    function getWeekKey(){
      const now = new Date();
      const start = new Date(now);
      start.setHours(0,0,0,0);
      start.setDate(now.getDate() - ((now.getDay()+6)%7)); // segunda
      return start.toISOString().slice(0,10);
    }

    /***********************
     * Welcome dots / carrossel
     ***********************/
    function initWelcomeCarousel(){
      const slides = Array.from(document.querySelectorAll(".wSlide"));
      const dotsBox = $("wDots");
      if(!slides.length || !dotsBox) return;

      dotsBox.innerHTML = "";
      slides.forEach((_, idx)=>{
        const d = document.createElement("div");
        d.className = "wDot" + (idx===0 ? " on" : "");
        d.addEventListener("click", ()=> setSlide(idx));
        dotsBox.appendChild(d);
      });

      let cur = 0;
      function setSlide(i){
        cur = i;
        slides.forEach(s=>s.classList.remove("active"));
        slides[i].classList.add("active");
        const dots = dotsBox.querySelectorAll(".wDot");
        dots.forEach(x=>x.classList.remove("on"));
        dots[i].classList.add("on");
      }
      window.__setSlide = setSlide;

      // auto
      setInterval(()=>{
        cur = (cur + 1) % slides.length;
        setSlide(cur);
      }, 4500);
    }

    /***********************
     * Cadastro + Esportes
     ***********************/
    const ESPORTES = ["Muscula√ß√£o","Futebol","Corrida","Crossfit","Ciclismo","Nata√ß√£o","Luta","Basquete","V√¥lei","Yoga","Pilates","Caminhada","Muay Thai","Jiu-jitsu","Handebol","T√™nis","Funcional"];
    let selectedSports = new Set();

    function buildSportsChips(){
      const box = $("chipsEsportes");
      if(!box) return;
      box.innerHTML = "";
      ESPORTES.forEach(name=>{
        const div = document.createElement("div");
        div.className = "chip";
        div.textContent = name;
        div.addEventListener("click", ()=>{
          if(selectedSports.has(name)) selectedSports.delete(name);
          else selectedSports.add(name);
          div.classList.toggle("on");
        });
        box.appendChild(div);
      });

      const p = safeJSON(KEY_PROFILE);
      if(p && Array.isArray(p.esportes)){
        selectedSports = new Set(p.esportes);
        [...box.querySelectorAll(".chip")].forEach(ch=>{
          if(selectedSports.has(ch.textContent)) ch.classList.add("on");
        });
      }
    }

    function salvarCadastro(){
      const perfil = {
        nome: ($("nome")?.value || "").trim(),
        objetivo: $("objetivo")?.value || "",
        restricao: $("restricao")?.value || "",
        pcd: $("pcd")?.value || "",
        esportes: Array.from(selectedSports),
        updatedAt: Date.now(),
      };
      setJSON(KEY_PROFILE, perfil);
      const out = $("outCadastro");
      if(out){ out.style.display="block"; out.textContent="‚úÖ Cadastro salvo."; }
      updatePerfilBox();
      hydrateTreinoTema();
    }
    window.salvarCadastro = salvarCadastro;

    function limparCadastro(){
      localStorage.removeItem(KEY_PROFILE);
      ["nome"].forEach(id=>{ if($(id)) $(id).value=""; });
      ["objetivo","restricao","pcd"].forEach(id=>{ if($(id)) $(id).value=""; });
      selectedSports = new Set();
      buildSportsChips();
      const out = $("outCadastro");
      if(out){ out.style.display="block"; out.textContent="üßπ Cadastro limpo."; }
      updatePerfilBox();
      hydrateTreinoTema();
    }
    window.limparCadastro = limparCadastro;

    function updatePerfilBox(){
      const p = safeJSON(KEY_PROFILE) || {};
      const sports = Array.isArray(p.esportes) && p.esportes.length ? p.esportes.join(", ") : "‚Äî";
      const html = `
        <div><b>Nome:</b> ${escapeHtml(p.nome || "‚Äî")}</div>
        <div><b>Objetivo:</b> ${escapeHtml(p.objetivo || "‚Äî")}</div>
        <div><b>Restri√ß√£o:</b> ${escapeHtml(p.restricao || "‚Äî")}</div>
        <div><b>PCD/Dificuldade:</b> ${escapeHtml(p.pcd || "‚Äî")}</div>
        <div><b>Esportes:</b> ${escapeHtml(sports)}</div>
      `;
      if($("perfilBox")) $("perfilBox").innerHTML = html;
    }

    function resetAll(){
      if(!confirm("Tem certeza? Isso apaga os dados locais do app neste navegador.")) return;
      Object.keys(localStorage).forEach(k=>{
        if(k.startsWith("cp_")) localStorage.removeItem(k);
      });
      location.reload();
    }
    window.resetAll = resetAll;

    /***********************
     * Prato (foto + score)
     ***********************/
    function getPlateWeek(){
      const weekKey = getWeekKey();
      const all = safeJSON(KEY_PLATE_WEEK) || {};
      if(!all[weekKey]) all[weekKey] = [];
      return { all, weekKey, list: all[weekKey] };
    }
    function savePlateWeek(all){ setJSON(KEY_PLATE_WEEK, all); }

    function wirePlateInput(){
      const btnCam = $("btnCamera");
      const btnGal = $("btnGaleria");
      const fc = $("fileCamera");
      const fg = $("fileGaleria");

      if(btnCam && fc) btnCam.addEventListener("click", ()=> fc.click());
      if(btnGal && fg) btnGal.addEventListener("click", ()=> fg.click());

      async function onFile(file){
        if(!file) return;
        const reader = new FileReader();
        reader.onload = ()=>{
          const dataUrl = String(reader.result || "");
          $("plateImg").src = dataUrl;
          $("platePreview").style.display = "block";
          // n√£o salvamos a imagem (pra n√£o estourar storage), s√≥ mostramos
        };
        reader.readAsDataURL(file);
      }
      if(fc) fc.addEventListener("change", ()=> onFile(fc.files?.[0]));
      if(fg) fg.addEventListener("change", ()=> onFile(fg.files?.[0]));
    }

    function avaliarPrato(){
      const desc = ($("plateDesc")?.value || "").trim();
      const portion = $("platePortion")?.value || "M√©dia";
      const quality = $("plateQuality")?.value || "Boa";

      // score simples, mas com varia√ß√£o e perfil
      const p = safeJSON(KEY_PROFILE) || {};
      let base = 70;
      if(quality === "Excelente") base += 18;
      if(quality === "Boa") base += 10;
      if(quality === "M√©dia") base += 3;
      if(quality === "Ruim") base -= 10;

      if(portion === "Pequena") base += 3;
      if(portion === "Grande") base -= 3;

      const t = (desc.toLowerCase());
      if(t.includes("salada")) base += 6;
      if(t.includes("frango") || t.includes("ovo") || t.includes("peixe")) base += 5;
      if(t.includes("refrigerante") || t.includes("frit") || t.includes("doce")) base -= 8;

      // ajusta pelo objetivo
      const obj = (p.objetivo || "").toLowerCase();
      if(obj.includes("emag")){ if(portion==="Grande") base -= 6; }
      if(obj.includes("hiper") || obj.includes("massa")){ if(t.includes("arroz") || t.includes("feij√£o")) base += 2; }

      // ru√≠do leve
      base += Math.floor(Math.random()*5) - 2;
      const score = Math.max(30, Math.min(100, Math.round(base)));

      const { all, weekKey, list } = getPlateWeek();
      list.push({ ts: Date.now(), desc: desc || "Prato registrado", score });
      all[weekKey] = list.slice(-50);
      savePlateWeek(all);

      const pill = $("plateScore");
      pill.style.display = "inline-flex";
      pill.textContent = `Score do prato: ${score}/100`;

      renderPlateHistory();
      // tamb√©m alimenta evolu√ß√£o
      addEvoPoint("prato", score >= 80 ? 2 : 1);
    }
    window.avaliarPrato = avaliarPrato;

    function renderPlateHistory(){
      const { list } = getPlateWeek();
      const el = $("plateHistory");
      if(!el) return;
      if(!list.length){
        el.textContent = "Sem registros nesta semana.";
        return;
      }
      const avg = Math.round(list.reduce((a,b)=>a+(b.score||0),0)/list.length);
      el.innerHTML = `Registros: <b>${list.length}</b> ‚Ä¢ M√©dia: <b>${avg}/100</b>`;
    }

    /***********************
     * Dieta (variedade grande)
     ***********************/
    const DIETA_POOLS = {
      "Emagrecimento": {
        kcal: "450‚Äì650",
        meals: [
          ["Caf√©", ["Omelete 2 ovos + caf√© sem a√ß√∫car", "Iogurte natural + fruta + chia", "Aveia + banana + canela"]],
          ["Almo√ßo", ["Frango grelhado + salada + arroz integral", "Carne magra + legumes + feij√£o", "Peixe + batata doce + salada"]],
          ["Lanche", ["Fruta + castanhas", "Sandu√≠che integral de atum", "Iogurte + granola sem a√ß√∫car"]],
          ["Jantar", ["Omelete + legumes", "Sopa de legumes com frango", "Salada grande com prote√≠na"]],
        ]
      },
      "Hipertrofia": {
        kcal: "700‚Äì1000",
        meals: [
          ["Caf√©", ["Aveia + banana + whey", "P√£o integral + ovos + queijo", "Tapioca + frango desfiado"]],
          ["Almo√ßo", ["Arroz + feij√£o + carne + salada", "Macarr√£o + frango + legumes", "Mandioca + carne + feij√£o"]],
          ["Lanche", ["Vitamina (banana + leite + aveia)", "Iogurte + granola + mel", "P√£o + pasta de amendoim"]],
          ["Jantar", ["Arroz + frango + legumes", "Batata doce + ovos + salada", "Peixe + arroz + feij√£o"]],
        ]
      },
      "Performance": {
        kcal: "600‚Äì900",
        meals: [
          ["Caf√©", ["Ovos + fruta + aveia", "Iogurte + banana + aveia", "P√£o integral + ovos"]],
          ["Almo√ßo", ["Carbo + prote√≠na + salada", "Frango + arroz + feij√£o", "Peixe + arroz + legumes"]],
          ["Pr√©-treino", ["Banana + caf√©", "P√£o + mel", "Fruta + iogurte"]],
          ["P√≥s-treino", ["Prote√≠na + carbo", "Iogurte + fruta", "Ovos + arroz"]],
        ]
      },
      "Low carb": {
        kcal: "450‚Äì750",
        meals: [
          ["Caf√©", ["Ovos mexidos + abacate", "Iogurte natural + castanhas", "Omelete + queijo"]],
          ["Almo√ßo", ["Carne + salada + legumes", "Frango + legumes + azeite", "Peixe + salada"]],
          ["Lanche", ["Castanhas + fruta", "Queijo + tomate", "Iogurte + chia"]],
          ["Jantar", ["Omelete + salada", "Sopa low carb", "Frango + legumes"]],
        ]
      },
      "Econ√¥mica": {
        kcal: "500‚Äì850",
        meals: [
          ["Caf√©", ["Ovos + p√£o", "Aveia + banana", "Tapioca simples"]],
          ["Almo√ßo", ["Arroz + feij√£o + ovo + salada", "Macarr√£o + sardinha", "Frango + arroz + feij√£o"]],
          ["Lanche", ["Banana", "P√£o com pasta", "Iogurte simples"]],
          ["Jantar", ["Ovos + arroz", "Sopa simples", "Frango + legumes"]],
        ]
      },
      "Vegetariana": {
        kcal: "500‚Äì850",
        meals: [
          ["Caf√©", ["Aveia + banana", "Iogurte (se usar) + fruta", "Tapioca + queijo (se usar)"]],
          ["Almo√ßo", ["Lentilha + arroz + salada", "Gr√£o-de-bico + legumes", "Feij√£o + arroz + salada"]],
          ["Lanche", ["Fruta + castanhas", "Iogurte + granola", "P√£o integral + pasta"]],
          ["Jantar", ["Omelete (se usar) + salada", "Lentilha + legumes", "Sopa de legumes"]],
        ]
      },
      "Vegana": {
        kcal: "500‚Äì850",
        meals: [
          ["Caf√©", ["Aveia + banana + pasta de amendoim", "Vitamina com leite vegetal", "P√£o + pasta"]],
          ["Almo√ßo", ["Feij√£o + arroz + salada", "Gr√£o-de-bico + legumes", "Lentilha + arroz"]],
          ["Lanche", ["Fruta + castanhas", "P√£o + pasta", "Mix de sementes"]],
          ["Jantar", ["Sopa de legumes", "Feij√£o + salada", "Legumes salteados + arroz"]],
        ]
      },
      "Diabetes": {
        kcal: "500‚Äì850",
        meals: [
          ["Caf√©", ["Ovos + fruta", "Iogurte natural + chia", "Aveia em por√ß√£o controlada"]],
          ["Almo√ßo", ["Prote√≠na + salada + feij√£o", "Peixe + legumes + arroz integral", "Carne magra + legumes"]],
          ["Lanche", ["Castanhas + fruta", "Iogurte natural", "Queijo + tomate"]],
          ["Jantar", ["Omelete + salada", "Sopa de legumes", "Prote√≠na + legumes"]],
        ]
      },
      "Hipertens√£o": {
        kcal: "500‚Äì850",
        meals: [
          ["Caf√©", ["Ovos + fruta", "Iogurte natural", "Aveia + banana"]],
          ["Almo√ßo", ["Comida com pouco sal + salada", "Frango + legumes", "Peixe + arroz"]],
          ["Lanche", ["Fruta", "Castanhas", "Iogurte"]],
          ["Jantar", ["Sopa leve", "Omelete + salada", "Legumes + prote√≠na"]],
        ]
      },
      "Sem lactose": {
        kcal: "500‚Äì850",
        meals: [
          ["Caf√©", ["Ovos + fruta", "Aveia + banana", "Tapioca + frango"]],
          ["Almo√ßo", ["Frango + arroz + feij√£o", "Peixe + legumes", "Carne + salada"]],
          ["Lanche", ["Fruta + castanhas", "P√£o + pasta", "Vitamina com leite vegetal"]],
          ["Jantar", ["Omelete + legumes", "Sopa de legumes", "Prote√≠na + salada"]],
        ]
      },
      "Sem gl√∫ten": {
        kcal: "500‚Äì850",
        meals: [
          ["Caf√©", ["Tapioca + ovos", "Ovos + fruta", "Aveia sem gl√∫ten (se tiver)"]],
          ["Almo√ßo", ["Arroz + feij√£o + carne", "Mandioca + frango + salada", "Batata + peixe"]],
          ["Lanche", ["Fruta + castanhas", "Iogurte (se usar)", "Tapioca"]],
          ["Jantar", ["Omelete + salada", "Sopa", "Legumes + prote√≠na"]],
        ]
      }
    };

    function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

    function gerarDieta(forceNew=false){
      const tipo = $("tipoDieta")?.value || "Emagrecimento";
      const pref = $("prefDieta")?.value || "Brasil (comida normal)";
      const pool = DIETA_POOLS[tipo] || DIETA_POOLS["Emagrecimento"];

      const seed = Date.now() + (forceNew ? Math.floor(Math.random()*99999) : 0);
      // monta dieta com varia√ß√µes
      const plan = [];
      pool.meals.forEach(([title, opts], idx)=>{
        // leve varia√ß√£o por prefer√™ncia
        let chosen = pick(opts);
        if(pref.includes("R√°pida")){
          if(title === "Almo√ßo" || title === "Jantar") chosen = chosen.replace(" + ", " ‚Ä¢ ");
        }
        plan.push({ t: title, d: chosen, k: pool.kcal });
      });

      setJSON(KEY_DIETA, { tipo, pref, plan, createdAt: seed });
      renderDieta();
    }
    window.gerarDieta = gerarDieta;

    function renderDieta(){
      const box = $("dietaBox");
      if(!box) return;
      const d = safeJSON(KEY_DIETA);
      box.innerHTML = "";

      if(!d || !d.plan){
        const s = document.createElement("div");
        s.className="status";
        s.textContent="Gere uma dieta para aparecer aqui.";
        box.appendChild(s);
        return;
      }

      const head = document.createElement("div");
      head.className = "status";
      head.innerHTML = `<b>${escapeHtml(d.tipo)}</b> ‚Ä¢ ${escapeHtml(d.pref)} ‚Ä¢ Faixa: <b>${escapeHtml(d.plan[0]?.k || "‚Äî")}</b>`;
      box.appendChild(head);

      d.plan.forEach(m=>{
        const div = document.createElement("div");
        div.className="meal";
        div.innerHTML = `
          <div>
            <div class="title">${escapeHtml(m.t)}</div>
            <p>${escapeHtml(m.d)}</p>
          </div>
          <div class="kcal">${escapeHtml(m.k || "‚Äî")}<br/>kcal</div>
        `;
        box.appendChild(div);
      });
    }

    /***********************
     * Treino (esporte + condi√ß√£o)
     ***********************/
    function hydrateTreinoTema(){
      const sel = $("temaTreino");
      if(!sel) return;
      const p = safeJSON(KEY_PROFILE) || {};
      const sports = Array.isArray(p.esportes) && p.esportes.length ? p.esportes : ["Muscula√ß√£o","Corrida"];
      sel.innerHTML = "";
      sports.forEach(s=>{
        const opt = document.createElement("option");
        opt.textContent = s;
        sel.appendChild(opt);
      });
    }

    function buildTreinoPlan(tema, intensidade, perfil){
      const pcd = (perfil.pcd || "").toLowerCase();
      const restr = (perfil.restricao || "").toLowerCase();

      const lowImpact = pcd.includes("mobil") || pcd.includes("idos") || pcd.includes("les") || pcd.includes("obes") || pcd.includes("visual") || pcd.includes("audit");

      const base = {
        "Muscula√ß√£o": [
          ["Segunda", ["Agachamento (ou cadeira)", "Supino (ou flex√£o)", "Remada (ou el√°stico)"]],
          ["Quarta", ["Desenvolvimento", "Puxada", "Abdominal prancha"]],
          ["Sexta", ["Levantamento terra (leve)", "Rosca", "Tr√≠ceps"]],
        ],
        "Corrida": [
          ["Segunda", ["Corrida leve 25‚Äì35 min", "Mobilidade 10 min"]],
          ["Quarta", ["Intervalado leve (8x 1min)", "Alongamento"]],
          ["Sexta", ["Corrida moderada 35‚Äì45 min", "Core"]],
        ],
        "Futebol":[
          ["Segunda", ["Arranque", "Controle de bola", "Finaliza√ß√£o"]],
          ["Quarta", ["Agilidade", "Passe e dom√≠nio", "Resist√™ncia"]],
          ["Sexta", ["Jogo reduzido", "Alongamento"]],
        ],
        "Basquete":[
          ["Ter√ßa", ["Drible", "Arremessos", "Pliometria"]],
          ["Quinta", ["Defesa lateral", "Bandejas", "Condicionamento"]],
          ["S√°bado", ["Treino de jogo", "Alongamento"]],
        ],
        "Ciclismo":[
          ["Ter√ßa", ["Pedal leve 30‚Äì45 min", "Mobilidade"]],
          ["Quinta", ["Subidas leves", "Core"]],
          ["S√°bado", ["Pedal moderado 45‚Äì70 min", "Alongamento"]],
        ],
        "Nata√ß√£o":[
          ["Segunda", ["T√©cnica 30 min", "Respira√ß√£o"]],
          ["Quarta", ["S√©ries leves", "Alongamento"]],
          ["Sexta", ["Nado cont√≠nuo 25‚Äì40 min", "Mobilidade"]],
        ],
        "Yoga":[
          ["Segunda", ["Fluxo leve 20‚Äì30 min", "Respira√ß√£o"]],
          ["Quarta", ["Mobilidade + equil√≠brio", "Relaxamento"]],
          ["Sexta", ["Alongamentos profundos", "Posturas base"]],
        ],
        "Pilates":[
          ["Segunda", ["Core b√°sico", "Postura"]],
          ["Quarta", ["Estabilidade", "Mobilidade"]],
          ["Sexta", ["Fortalecimento leve", "Alongamento"]],
        ],
        "Crossfit":[
          ["Segunda", ["For√ßa + WOD leve", "Mobilidade"]],
          ["Quarta", ["T√©cnica + Metcon", "Core"]],
          ["Sexta", ["WOD moderado", "Alongamento"]],
        ],
        "Muay Thai":[
          ["Ter√ßa", ["Sombra 10 min", "Chutes b√°sicos", "Combina√ß√µes"]],
          ["Quinta", ["Manopla", "Defesas", "Condicionamento"]],
          ["S√°bado", ["Clinch", "Sequ√™ncias", "Alongamento"]],
        ],
        "Luta":[
          ["Ter√ßa", ["T√©cnica", "Movimenta√ß√£o", "Condicionamento"]],
          ["Quinta", ["Drills", "For√ßa geral", "Alongamento"]],
          ["S√°bado", ["T√©cnica + rounds", "Mobilidade"]],
        ],
        "Caminhada":[
          ["Segunda", ["Caminhada 25‚Äì40 min", "Alongamento"]],
          ["Quarta", ["Caminhada 30‚Äì45 min", "Mobilidade"]],
          ["Sexta", ["Caminhada 35‚Äì55 min", "Core leve"]],
        ],
        "Funcional":[
          ["Segunda", ["Agachamento", "Flex√£o", "Remada el√°stico"]],
          ["Quarta", ["Afundo", "Desenvolvimento", "Prancha"]],
          ["Sexta", ["Circuito leve", "Alongamento"]],
        ],
        "V√¥lei":[
          ["Ter√ßa", ["Saque + manchete", "Agilidade", "Pliometria leve"]],
          ["Quinta", ["Ataque + bloqueio", "Core", "Alongamento"]],
          ["S√°bado", ["Treino de jogo", "Mobilidade"]],
        ],
        "Handebol":[
          ["Ter√ßa", ["Arremesso", "Passe", "Agilidade"]],
          ["Quinta", ["Resist√™ncia", "Defesa", "Core"]],
          ["S√°bado", ["Jogo reduzido", "Alongamento"]],
        ],
        "T√™nis":[
          ["Ter√ßa", ["Forehand/Backhand", "Footwork", "Core"]],
          ["Quinta", ["Saque", "Ralis", "Mobilidade"]],
          ["S√°bado", ["Partida leve", "Alongamento"]],
        ],
        "Jiu-jitsu":[
          ["Ter√ßa", ["T√©cnica base", "Movimenta√ß√£o", "Condicionamento"]],
          ["Quinta", ["Drills", "For√ßa pegada", "Alongamento"]],
          ["S√°bado", ["T√©cnica + rolas", "Mobilidade"]],
        ],
      };

      let dias = base[tema] || base["Muscula√ß√£o"];

      // se baixo impacto, adapta
      if(lowImpact){
        dias = dias.map(([day, exs])=>{
          const adapted = exs.map(e=>{
            if(e.toLowerCase().includes("pliometria")) return "Pliometria (opcional) ou caminhada r√°pida";
            if(e.toLowerCase().includes("corrida")) return "Caminhada acelerada / bike leve";
            if(e.toLowerCase().includes("terra")) return "Levantamento terra (muito leve) ou ponte de gl√∫teos";
            return e + " (adaptado)";
          });
          return [day, adapted];
        });
      }

      // nota de cuidado se restri√ß√£o s√©ria
      let note = "";
      if(restr.includes("hipert") || restr.includes("diab")){
        note = "Aten√ß√£o: monitore sinais, mantenha hidrata√ß√£o e ajuste intensidade conforme se sentir.";
      }

      // intensidade
      const intLabel = intensidade;
      return { tema, intensidade: intLabel, dias, note, createdAt: Date.now() };
    }

    function renderTreino(){
      const box = $("treinoSemana");
      if(!box) return;
      const t = safeJSON(KEY_TREINO);
      box.innerHTML = "";

      if(!t || !t.dias){
        const s = document.createElement("div");
        s.className="status";
        s.textContent="Gere um treino para aparecer aqui.";
        box.appendChild(s);
        return;
      }

      if(t.note){
        const n = document.createElement("div");
        n.className = "hint";
        n.style.marginTop = "10px";
        n.innerHTML = "‚ö†Ô∏è " + escapeHtml(t.note);
        box.appendChild(n);
      }

      t.dias.forEach(d=>{
        const day = document.createElement("div");
        day.className="dayCard";
        day.innerHTML = `<div class="dayTitle"><span>${escapeHtml(d[0])}</span><span class="muted">${escapeHtml(t.tema)} ‚Ä¢ ${escapeHtml(t.intensidade)}</span></div>`;
        (d[1]||[]).forEach(ex=>{
          const row = document.createElement("div");
          row.className="exercise";
          const left = document.createElement("div");
          left.innerHTML = `<b>${escapeHtml(ex)}</b><div class="muted" style="font-size:12px; margin-top:4px">T√©cnica no YouTube</div>`;
          const btn = document.createElement("button");
          btn.className="ytBtn";
          btn.textContent="Ver";
          btn.addEventListener("click", ()=> abrirLink(`https://www.youtube.com/results?search_query=${encodeURIComponent(ex+" como fazer")}`));
          row.appendChild(left);
          row.appendChild(btn);
          day.appendChild(row);
        });
        box.appendChild(day);
      });
    }

    function gerarTreino(){
      const tema = $("temaTreino")?.value || "Muscula√ß√£o";
      const intensidade = $("intTreino")?.value || "Moderado";
      const perfil = safeJSON(KEY_PROFILE) || {};
      const plano = buildTreinoPlan(tema, intensidade, perfil);
      setJSON(KEY_TREINO, plano);
      renderTreino();

      const out = $("outTreino");
      if(out){ out.style.display="block"; out.textContent = `‚úÖ Treino gerado: ${tema} (${intensidade}).`; }

      // marca evolu√ß√£o
      addEvoPoint("treino", 2);
    }
    window.gerarTreino = gerarTreino;

    function limparTreino(){
      localStorage.removeItem(KEY_TREINO);
      renderTreino();
      const out = $("outTreino");
      if(out){ out.style.display="block"; out.textContent="üßπ Treino removido."; }
    }
    window.limparTreino = limparTreino;

    /***********************
     * Evolu√ß√£o (chart + streak + badges)
     ***********************/
    let evoChart = null;

    function getEvo(){
      const weekKey = getWeekKey();
      const all = safeJSON(KEY_EVO) || {};
      if(!all[weekKey]){
        all[weekKey] = { weekKey, points:[0,0,0,0,0,0,0], streak:0, lastDay:null, level:1 };
      }
      return { all, weekKey, data: all[weekKey] };
    }
    function saveEvo(all){ setJSON(KEY_EVO, all); }

    function dayIndex(){
      const now = new Date();
      // segunda=0 ... domingo=6
      return (now.getDay()+6)%7;
    }

    function addEvoPoint(type, pts){
      const { all, weekKey, data } = getEvo();
      const idx = dayIndex();
      data.points[idx] = Math.max(0, (data.points[idx]||0) + (pts||1));

      // streak
      const today = new Date().toISOString().slice(0,10);
      if(data.lastDay !== today){
        // se ontem era o dia anterior, incrementa, sen√£o reseta
        const y = new Date(); y.setDate(y.getDate()-1);
        const yesterday = y.toISOString().slice(0,10);
        if(data.lastDay === yesterday) data.streak = (data.streak||0) + 1;
        else data.streak = 1;
        data.lastDay = today;
      }

      // level (simples)
      const total = data.points.reduce((a,b)=>a+(b||0),0);
      data.level = Math.max(1, Math.floor(total/8) + 1);

      all[weekKey] = data;
      saveEvo(all);
      renderEvo();
      renderDash(); // pra refletir
    }

    function logEvo(kind){
      if(kind === "treino") addEvoPoint("treino", 2);
      else addEvoPoint("prato", 1);
    }
    window.logEvo = logEvo;

    function renderBadges(total, streak){
      const box = $("badges");
      if(!box) return;
      box.innerHTML = "";
      const badges = [
        { t:"ü•â Primeiros passos", ok: total>=3 },
        { t:"ü•à Ritmo forte", ok: total>=10 },
        { t:"ü•á Elite semanal", ok: total>=18 },
        { t:"üî• Streak 3+", ok: streak>=3 },
        { t:"‚ö° Streak 5+", ok: streak>=5 },
      ];
      badges.forEach(b=>{
        const d = document.createElement("div");
        d.className = "chip" + (b.ok ? " on" : "");
        d.textContent = b.t;
        box.appendChild(d);
      });
    }

    function renderEvo(){
      const { data } = getEvo();
      const total = data.points.reduce((a,b)=>a+(b||0),0);

      if($("streakTxt")) $("streakTxt").textContent = `${data.streak || 0} dias`;
      if($("levelTxt")) $("levelTxt").textContent = `N√≠vel ${data.level || 1}`;

      renderBadges(total, data.streak || 0);

      const hint = $("evoHint");
      if(hint){
        hint.innerHTML = `Pontos na semana: <b>${total}</b> ‚Ä¢ Hoje: <b>${data.points[dayIndex()]||0}</b>`;
      }

      // chart
      const ctx = $("evoChart");
      if(!ctx) return;

      const labels = ["Seg","Ter","Qua","Qui","Sex","S√°b","Dom"];
      if(evoChart) evoChart.destroy();
      evoChart = new Chart(ctx, {
        type: "line",
        data: {
          labels,
          datasets: [{
            label: "Evolu√ß√£o",
            data: data.points,
            tension: 0.35,
            fill: true
          }]
        },
        options: {
          plugins: {
            legend: { display:false },
            tooltip: { enabled:true }
          },
          scales: {
            x: { ticks: { color: "rgba(234,242,255,.65)" }, grid: { color: "rgba(255,255,255,.06)" } },
            y: { ticks: { color: "rgba(234,242,255,.65)" }, grid: { color: "rgba(255,255,255,.06)" }, beginAtZero:true }
          }
        }
      });
    }

    /***********************
     * Progresso (dashboard 3D)
     ***********************/
    function getDash(){
      const d = safeJSON(KEY_DASH);
      if(d && typeof d === "object") return d;
      // default
      return { kcal:0, km:0, done:0, goal:5, weekKey: getWeekKey() };
    }
    function setDash(d){
      setJSON(KEY_DASH, d);
      renderDash();
    }

    function weekLabelFromKey(weekKey){
      const [y,m,d] = weekKey.split("-");
      return `Semana ‚Ä¢ ${d}/${m}`;
    }

    function renderDash(){
      const d = getDash();
      // se mudou semana, zera
      const wk = getWeekKey();
      if(d.weekKey !== wk){
        d.weekKey = wk; d.kcal=0; d.km=0; d.done=0;
        setJSON(KEY_DASH, d);
      }

      $("proKcal").textContent = String(Math.round(d.kcal));
      $("proKm").textContent = String(Math.round(d.km));
      $("proDone").textContent = String(d.done);
      $("proGoal").textContent = String(d.goal);
      $("proDays").textContent = String(d.done);
      $("proDaysGoal").textContent = String(d.goal);
      $("proWeek").textContent = weekLabelFromKey(d.weekKey);
      $("proMode").textContent = "Local";

      const pct = d.goal > 0 ? Math.max(0, Math.min(100, Math.round((d.done / d.goal) * 100))) : 0;
      $("proPct").textContent = pct + "%";
      const C = 301.59;
      const offset = C - (C * pct / 100);
      const ring = $("ringProg");
      ring.style.strokeDasharray = String(C);
      ring.style.strokeDashoffset = String(offset);

      const resumo = $("proResumo");
      if(resumo){
        resumo.innerHTML = `Treinos: <b>${d.done}/${d.goal}</b> ‚Ä¢ Movimento: <b>${Math.round(d.km)}</b> ‚Ä¢ Energia: <b>${Math.round(d.kcal)}</b>`;
      }
      updatePerfilBox();
    }

    function addKcal(){
      const d = getDash();
      d.kcal += 1;
      setDash(d);
    }
    window.addKcal = addKcal;

    function addKm(){
      const d = getDash();
      d.km += 1;
      setDash(d);
    }
    window.addKm = addKm;

    function addTreinoDone(){
      const d = getDash();
      d.done = Math.min(d.goal, d.done + 1);
      setDash(d);
      addEvoPoint("treino", 2);
    }
    window.addTreinoDone = addTreinoDone;

    function resetProgresso(){
      const d = getDash();
      d.kcal = 0; d.km = 0; d.done = 0; d.weekKey = getWeekKey();
      setDash(d);
    }
    window.resetProgresso = resetProgresso;

    function setGoalDaysPrompt(){
      const d = getDash();
      const v = prompt("Meta de treinos na semana (ex: 4, 5, 6):", String(d.goal));
      if(v === null) return;
      const n = Math.max(1, Math.min(14, parseInt(v,10) || d.goal));
      d.goal = n;
      if(d.done > d.goal) d.done = d.goal;
      setDash(d);
    }
    window.setGoalDaysPrompt = setGoalDaysPrompt;

    /***********************
     * Convites
     ***********************/
    function getInvite(){
      let inv = safeJSON(KEY_INV);
      if(inv) return inv;
      inv = { code: "ELITE-" + Math.random().toString(16).slice(2,8).toUpperCase() };
      setJSON(KEY_INV, inv);
      return inv;
    }
    function getMyInviteLink(){
      const inv = getInvite();
      const url = new URL(location.href);
      url.searchParams.set("ref", inv.code);
      return url.toString();
    }
    async function copyInviteLink(){
      const link = getMyInviteLink();
      try{ await navigator.clipboard.writeText(link); alert("‚úÖ Link copiado!"); }
      catch{ prompt("Copie o link:", link); }
    }
    window.copyInviteLink = copyInviteLink;

    function shareInvite(){
      const link = getMyInviteLink();
      const text = `Baixa o CheckPrato Elite e usa meu link: ${link}`;
      if(navigator.share){
        navigator.share({ title:"CheckPrato Elite", text, url: link }).catch(()=>{});
      }else{
        copyInviteLink();
      }
    }
    window.shareInvite = shareInvite;

    function renderInvite(){
      const inv = getInvite();
      const link = getMyInviteLink();
      if($("myCode")) $("myCode").textContent = inv.code;
      if($("myLink")) $("myLink").textContent = link;
    }

    /***********************
     * Sa√∫de (abre fonte oficial)
     ***********************/
    function openSaude(topic){
      // mant√©m oficial. voc√™ pode futuramente mapear para p√°ginas espec√≠ficas.
      const base = "https://bvsms.saude.gov.br/";
      abrirLink(base);
    }
    window.openSaude = openSaude;

    /***********************
     * Init
     ***********************/
    function init(){
      wireNav();
      buildSportsChips();
      hydrateTreinoTema();
      wirePlateInput();
      initWelcomeCarousel();

      updatePerfilBox();
      renderPlateHistory();
      renderDieta();
      renderTreino();
      renderEvo();
      renderDash();
      renderInvite();

      // top msg
      if($("authTxt")) $("authTxt").textContent = "Modo: Local";
      updateTopBtn();
    }

    init();
  </script>
</body>
</html>
