<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Confira o Prato Elite</title>

  <meta name="theme-color" content="#0a1320"/>
  <link rel="manifest" href="./manifest.json">
  <link rel="icon" sizes="192x192" href="./icon-192.png">
  <link rel="apple-touch-icon" href="./icon-192.png">

  <style>
    :root{
      --bg:#07121f;
      --bg2:#0b2033;
      --card:rgba(255,255,255,.04);
      --card2:rgba(255,255,255,.06);
      --stroke:rgba(255,255,255,.08);
      --txt:#eaf2ff;
      --muted:rgba(234,242,255,.72);
      --green:#21e6b6;
      --green2:#17caa0;
      --orange:#f6b23a;
      --shadow:0 20px 60px rgba(0,0,0,.45);
      --r:22px;
      --max:540px;
    }

    *{ box-sizing:border-box; }
    html, body{
      height:100%;
      margin:0;
      padding:0;
      background: var(--bg);
      color: var(--txt);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      overflow-x:hidden;
    }

    /* espa√ßo pro navbar fixo */
    body{ padding-bottom: calc(92px + env(safe-area-inset-bottom)); }

    a{ color: var(--green); text-decoration:none; }
    a:hover{ text-decoration:underline; }

    .wrap{
      max-width: var(--max);
      margin: 0 auto;
      padding: 16px 14px 24px;
    }

    .topbar{
      display:flex;
      align-items:center;
      gap:12px;
      margin-top:6px;
      margin-bottom: 14px;
    }
    .logo{
      width:44px;height:44px;border-radius:14px;
      background: linear-gradient(135deg, rgba(33,230,182,.35), rgba(33,230,182,.05));
      border:1px solid rgba(33,230,182,.35);
      display:flex;align-items:center;justify-content:center;
      font-weight:900;
      color:var(--green);
      box-shadow: var(--shadow);
      flex:0 0 auto;
      overflow:hidden;
    }
    .logo img{ width:100%; height:100%; object-fit:cover; display:block; }

    .brand{
      display:flex;flex-direction:column;gap:2px;
      min-width: 0;
      flex: 1 1 auto;
    }
    .brand small{color:var(--muted); letter-spacing:.08em; font-weight:800}
    .brand b{font-size:18px}

    .pill{
      display:flex;align-items:center;gap:8px;
      padding:10px 12px;border-radius:999px;
      background: rgba(255,255,255,.04);
      border:1px solid var(--stroke);
      color:var(--muted);
      font-weight:700;
      flex:0 0 auto;
      white-space:nowrap;
    }
    .pill .dot{
      width:10px;height:10px;border-radius:99px;background:var(--green);
      box-shadow: 0 0 0 6px rgba(33,230,182,.12);
    }

    .h1{
      font-size:34px;
      margin:12px 2px 14px;
      letter-spacing:.02em;
      color:var(--green);
      font-weight: 1000;
      line-height: 1.05;
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.03));
      border: 1px solid var(--stroke);
      border-radius: var(--r);
      padding: 16px;
      box-shadow: var(--shadow);
    }

    .hint{
      color: var(--muted);
      font-weight: 650;
      line-height: 1.35;
    }
    .muted{ opacity:.85; }

    .row{display:flex; gap:12px; flex-wrap:wrap}
    .col{flex:1 1 140px; min-width: 140px}

    .label{
      margin: 12px 2px 6px;
      color: rgba(234,242,255,.65);
      font-weight: 950;
      letter-spacing:.12em;
      text-transform: uppercase;
      font-size: 12px;
    }

    input, select, textarea{
      width:100%;
      padding:14px 14px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      color: var(--txt);
      outline: none;
      font-size: 15px;
    }
    textarea{ min-height: 90px; resize: vertical; }
    input::placeholder{color: rgba(234,242,255,.35)}
    select{appearance:none}

    .btn{
      width:100%;
      padding: 16px 16px;
      border-radius: 18px;
      border: 0;
      cursor: pointer;
      font-weight: 950;
      font-size: 16px;
      letter-spacing: .02em;
      background: linear-gradient(135deg, var(--green), var(--green2));
      color:#042019;
      box-shadow: 0 18px 45px rgba(33,230,182,.18);
      margin-top: 14px;
    }
    .btnSecondary{
      width:100%;
      padding: 14px 16px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.10);
      cursor: pointer;
      font-weight: 900;
      font-size: 15px;
      background: rgba(255,255,255,.05);
      color: var(--txt);
      margin-top: 10px;
    }
    .btnOrange{
      width:100%;
      padding: 16px 16px;
      border-radius: 18px;
      border: 0;
      cursor: pointer;
      font-weight: 950;
      font-size: 16px;
      background: linear-gradient(135deg, #ffcc5a, #f6b23a);
      color:#201400;
      margin-top: 12px;
      box-shadow: 0 18px 45px rgba(246,178,58,.18);
    }

    .status{
      margin-top: 10px;
      font-weight: 800;
      color: rgba(234,242,255,.86);
    }

    /* chips esportes */
    .chips{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top: 10px;
    }
    .chip{
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      color: var(--muted);
      font-weight: 900;
      cursor: pointer;
      user-select: none;
    }
    .chip.on{
      border-color: rgba(33,230,182,.45);
      background: rgba(33,230,182,.12);
      color: var(--txt);
      box-shadow: 0 0 0 6px rgba(33,230,182,.08);
    }

    /* telas */
    .screen{
      display:none;
      margin-top: 8px;
      width:100%;
      background: var(--bg);
      padding-bottom: calc(140px + env(safe-area-inset-bottom));
    }
    .screen.active{ display:block; }

    /* nav fixo */
    .nav{
      position:fixed;
      left:0; right:0; bottom:0;
      padding: 10px 10px calc(10px + env(safe-area-inset-bottom));
      background: #07121f;
      border-top: 1px solid rgba(255,255,255,.08);
      z-index: 1000;
    }
    .navInner{
      max-width: var(--max);
      margin: 0 auto;
      display:flex;
      gap:10px;
      overflow-x: auto;
      padding: 6px 6px;
      scrollbar-width: none;
    }
    .navInner::-webkit-scrollbar{display:none}
    .navBtn{
      flex:0 0 auto;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
      color: rgba(234,242,255,.6);
      font-weight: 950;
      padding: 12px 14px;
      border-radius: 999px;
      cursor:pointer;
      letter-spacing:.05em;
      white-space: nowrap;
    }
    .navBtn.active{
      background: rgba(33,230,182,.12);
      border-color: rgba(33,230,182,.35);
      color: var(--green);
      box-shadow: 0 0 0 6px rgba(33,230,182,.08);
    }

    /* cards dieta */
    .meal{
      display:flex;
      justify-content:space-between;
      gap:12px;
      padding: 16px;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
      margin-top: 12px;
    }
    .meal .title{
      font-weight: 950;
      color: var(--green);
      letter-spacing:.08em;
      text-transform: uppercase;
      font-size: 12px;
      margin-bottom: 6px;
    }
    .meal p{margin:0; color: rgba(234,242,255,.88); font-weight:750; line-height:1.35}
    .kcal{
      display:flex; align-items:center; justify-content:center;
      min-width: 88px;
      border-radius: 999px;
      border:1px solid rgba(33,230,182,.25);
      background: rgba(33,230,182,.08);
      color: var(--green);
      font-weight: 1000;
      padding: 10px 12px;
      text-align:center;
    }

    /* treino */
    .dayCard{
      margin-top: 12px;
      padding: 14px;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
    }
    .dayTitle{
      display:flex; align-items:center; justify-content:space-between;
      font-weight: 1000;
      color: rgba(234,242,255,.92);
      margin-bottom: 10px;
      letter-spacing:.03em;
    }
    .exercise{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
      padding: 12px 12px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.16);
      margin-top: 10px;
    }
    .ytBtn{
      border:0;
      border-radius: 999px;
      padding: 10px 12px;
      background: rgba(33,230,182,.10);
      border: 1px solid rgba(33,230,182,.25);
      color: var(--green);
      font-weight: 1000;
      cursor: pointer;
      min-width: 110px;
    }

    /* loja/parceiros */
    .shopGrid{display:flex; flex-direction:column; gap:12px; margin-top: 12px}
    .shopItem{
      padding: 16px;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
    }
    .shopItem h3{margin:0 0 6px; font-weight: 1000}

    .partnerList{display:flex; flex-direction:column; gap:12px; margin-top:12px}
    .partnerRow{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:14px;
      border-radius:18px;
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.06);
    }
    .partnerName{display:flex; flex-direction:column; gap:4px}
    .partnerName b{font-weight: 1000}

    /* prato */
    .plateBox{margin-top: 12px}
    .platePreview{
      width: 100%;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.14);
      overflow:hidden;
    }
    .platePreview img{width:100%; display:block}

    .miniRow{display:flex; gap:10px; flex-wrap:wrap}
    .miniBtn{
      flex: 1 1 160px;
      padding: 14px 14px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      color: var(--txt);
      font-weight: 900;
      cursor: pointer;
    }

    /* modal simples */
    .modalBack{
      display:none;
      position:fixed; inset:0;
      background: rgba(0,0,0,.55);
      z-index: 2000;
      padding: 20px;
      overflow:auto;
    }
    .modal{
      max-width: 560px;
      margin: 40px auto;
      background: #0b1726;
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 18px;
      box-shadow: 0 25px 80px rgba(0,0,0,.55);
      padding: 16px;
    }
    .modal h3{ margin: 0 0 10px; }
    .modal .closeRow{ display:flex; justify-content:space-between; align-items:center; gap:10px; }
    .xBtn{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: var(--txt);
      border-radius: 12px;
      padding: 8px 10px;
      font-weight: 900;
      cursor:pointer;
    }

    /* bot√£o topo */
    #btnTop{
      position:fixed;
      bottom:110px;
      right:18px;
      width:48px;
      height:48px;
      border-radius:50%;
      border:none;
      background:linear-gradient(135deg,#21e6b6,#17caa0);
      color:#042019;
      font-size:22px;
      font-weight:900;
      box-shadow:0 10px 25px rgba(0,0,0,.4);
      display:none;
      z-index:999;
      cursor:pointer;
    }

    /* esconder app quando n√£o logado */
    .hidden{ display:none !important; }
  </style>
</head>


<body>
  <div class="wrap">
    <div class="topbar">
      <div class="logo" id="logoBox">E</div>
      <div class="brand">
        <small>ELITE TERMINAL</small>
        <b>Confira o Prato Elite</b>
      </div>
      <div class="pill" id="pillAuth"><span class="dot"></span><span id="authTxt">Modo: Local</span></div>
    </div>

    <!-- BOAS VINDAS -->
    <section id="viewWelcome" class="screen active">
      <div class="h1">Bem-vindo üëã</div>

      <div class="card">
        <div class="hint">
          Aqui voc√™ monta seu perfil, gera dieta e treino, e analisa seu prato (IA).
          <br><br>
          <b>Recomendado:</b> entrar com Google/Email para salvar tudo na nuvem.
        </div>

        <div style="margin-top:14px" class="row">
          <div class="col">
            <button class="btn" type="button" onclick="openAuthModal()">Entrar / Criar conta</button>
          </div>
          <div class="col">
            <button class="btnSecondary" type="button" onclick="enterGuest()">Entrar como convidado</button>
          </div>
        </div>

        <div class="status" style="margin-top:12px">
          Ao entrar, voc√™ pode preencher o cadastro e come√ßar.
        </div>
      </div>
    </section>

    <!-- CADASTRO / PERFIL -->
    <section id="viewCadastro" class="screen">
      <div class="h1">CADASTRO</div>

      <div class="card">
        <div class="label">Foto do perfil</div>
        <div class="row" style="align-items:center">
          <div style="width:64px;height:64px;border-radius:18px;overflow:hidden;border:1px solid rgba(255,255,255,.10);background:rgba(0,0,0,.2)">
            <img id="avatarImg" alt="Foto" style="width:100%;height:100%;object-fit:cover;display:none"/>
            <div id="avatarFallback" style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-weight:1000;color:rgba(234,242,255,.7)">üë§</div>
          </div>
          <div style="flex:1">
            <button class="btnSecondary" type="button" onclick="pickAvatar()">Escolher foto</button>
            <input id="avatarFile" type="file" accept="image/*" style="display:none">
            <div class="hint" style="margin-top:6px">A foto fica salva no seu perfil.</div>
          </div>
        </div>

        <div class="row" style="margin-top:6px">
          <div class="col">
            <div class="label">Nome</div>
            <input id="nome" placeholder="Ex: Jonatan" />
          </div>
          <div class="col">
            <div class="label">Email (opcional)</div>
            <input id="emailPerfil" inputmode="email" placeholder="Ex: voce@gmail.com" />
          </div>
        </div>

        <div class="row">
          <div class="col">
            <div class="label">Peso (kg)</div>
            <input id="peso" inputmode="decimal" placeholder="Ex: 78.5" />
          </div>
          <div class="col">
            <div class="label">Altura (cm)</div>
            <input id="altura" inputmode="numeric" placeholder="Ex: 175" />
          </div>
        </div>

        <div class="row">
          <div class="col">
            <div class="label">Objetivo</div>
            <select id="objetivo">
              <option value="">Selecione</option>
              <option>Emagrecer</option>
              <option>Ganhar massa</option>
              <option>Manter</option>
              <option>Performance</option>
            </select>
          </div>
          <div class="col">
            <div class="label">N√≠vel</div>
            <select id="nivel">
              <option value="">Selecione</option>
              <option>Iniciante</option>
              <option>Intermedi√°rio</option>
              <option>Avan√ßado</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div class="col">
            <div class="label">Condi√ß√£o</div>
            <select id="condicao">
              <option value="">Selecione</option>
              <option>Saud√°vel</option>
              <option>Hipertens√£o</option>
              <option>Diabetes</option>
              <option>Les√£o / Dor</option>
            </select>
          </div>
          <div class="col">
            <div class="label">Restri√ß√£o</div>
            <select id="restricao">
              <option value="">Selecione</option>
              <option>Nenhuma</option>
              <option>Lactose</option>
              <option>Gl√∫ten</option>
              <option>Vegetariano</option>
              <option>Vegano</option>
            </select>
          </div>
        </div>

        <div class="label">Esportes (pode marcar v√°rios)</div>
        <div id="chipsEsportes" class="chips"></div>

        <div style="margin-top:10px">
          <label style="display:flex; gap:10px; align-items:center; font-weight:900; color:rgba(234,242,255,.9)">
            <input id="termo" type="checkbox" style="width:22px; height:22px"/>
            Aceito o termo (conte√∫do informativo)
          </label>
          <div class="hint" style="margin-top:6px">As sugest√µes s√£o informativas e n√£o substituem profissional.</div>
        </div>

        <button class="btn" type="button" onclick="salvarCadastro()">SALVAR / ATUALIZAR</button>
        <button class="btnSecondary" type="button" onclick="limparCadastro()">LIMPAR</button>

        <div id="outCadastro" class="status" style="display:none"></div>
      </div>

      <!-- FOTO DO PRATO + IA -->
      <div class="card plateBox" style="margin-top:14px">
        <div class="label">An√°lise do prato (IA)</div>
        <div class="hint">
          Fluxo: enviar foto ‚Üí analisar ‚Üí revisar ‚Üí confirmar.
          <br>Evita repetir a mesma foto e salva hist√≥rico.
        </div>

        <div class="miniRow" style="margin-top:12px">
          <button class="miniBtn" type="button" id="btnCamera">Tirar foto</button>
          <button class="miniBtn" type="button" id="btnGaleria">Escolher da galeria</button>
        </div>

        <input id="fileCamera" type="file" accept="image/*" capture="environment" style="display:none">
        <input id="fileGaleria" type="file" accept="image/*" style="display:none">

        <div class="platePreview" id="platePreview" style="margin-top:12px; display:none">
          <img id="plateImg" alt="Prato"/>
        </div>

        <button class="btnSecondary" type="button" onclick="analisarPrato()">Analisar com IA</button>

        <div id="plateResult" class="status" style="display:none"></div>

        <div id="plateConfirmBox" style="display:none; margin-top:10px">
          <div class="label">Confirma√ß√£o</div>
          <div class="hint">A IA sugeriu isso. Se quiser, edite antes de confirmar:</div>
          <textarea id="plateEdit"></textarea>
          <button class="btn" type="button" onclick="confirmarPrato()">Confirmar que √© isso</button>
          <button class="btnSecondary" type="button" onclick="refazerAnalise()">Refazer an√°lise</button>
        </div>
      </div>
    </section>

    <!-- DIETA -->
    <section id="viewDieta" class="screen">
      <div class="h1">DIETA</div>

      <div class="card">
        <div class="hint">
          Dieta simples (demo), adaptada ao objetivo.
          Se voc√™ n√£o gostar ou n√£o tiver algum alimento, clique em <b>Refazer</b>.
        </div>

        <button class="btn" type="button" onclick="gerarDieta()">GERAR DIETA</button>
        <button class="btnSecondary" type="button" onclick="refazerDieta()">REFazer / Trocar alimentos</button>

        <div id="dietaBox"></div>
      </div>
    </section>

    <!-- TREINO -->
    <section id="viewTreino" class="screen">
      <div class="h1">TREINO</div>

      <div class="card">
        <div class="hint">Treino semanal baseado no seu cadastro. Cada exerc√≠cio tem bot√£o ‚ÄúYouTube‚Äù.</div>

        <div class="row" style="margin-top:10px">
          <div class="col">
            <div class="label">Tema</div>
            <select id="temaTreino">
              <option>Academia</option>
              <option>Corrida</option>
              <option>Muay Thai</option>
              <option>Futebol</option>
              <option>Basquete</option>
            </select>
          </div>
          <div class="col">
            <div class="label">Intensidade</div>
            <select id="intTreino">
              <option>Leve</option>
              <option>Moderado</option>
              <option>Pesado</option>
            </select>
          </div>
        </div>

        <button class="btn" type="button" onclick="gerarTreino()">GERAR TREINO DA SEMANA</button>
        <button class="btnSecondary" type="button" onclick="limparTreino()">LIMPAR TREINO</button>

        <div id="outTreino" class="status" style="display:none"></div>
        <div id="treinoSemana"></div>
      </div>
    </section>

    <!-- LOJA -->
    <section id="viewLoja" class="screen">
      <div class="h1">LOJA</div>

      <div class="card">
        <div class="hint">Depois trocamos por seus links de afiliado/parcerias.</div>

        <div class="shopGrid">
          <div class="shopItem">
            <h3>Suplementos</h3>
            <p class="muted">Whey, creatina, vitaminas e pr√©-treinos para performance e recupera√ß√£o.</p>
            <button class="btnSecondary" type="button" onclick="switchView('parceiros')">Ver parceiros</button>
          </div>

          <div class="shopItem">
            <h3>Roupas fitness</h3>
            <p class="muted">T√™nis, camisetas, shorts e roupas para treino/corrida com conforto e durabilidade.</p>
            <button class="btnSecondary" type="button" onclick="switchView('parceiros')">Ver parceiros</button>
          </div>

          <div class="shopItem">
            <h3>Equipamentos</h3>
            <p class="muted">El√°sticos, corda, luvas, garrafas, etc.</p>
            <button class="btnSecondary" type="button" onclick="switchView('parceiros')">Ver parceiros</button>
          </div>
        </div>
      </div>
    </section>

    <!-- PARCEIROS -->
    <section id="viewParceiros" class="screen">
      <div class="h1">PARCEIROS</div>

      <div class="card">
        <div class="hint">Sites oficiais. Depois trocamos por links de afiliado quando voc√™ tiver.</div>

        <div class="partnerList">
          <div class="partnerRow">
            <div class="partnerName">
              <b>Growth Supplements</b>
              <div class="muted">Whey, creatina e suplementos</div>
            </div>
            <button class="btnSecondary" type="button" onclick="abrirLink('https://www.gsuplementos.com.br')">Abrir</button>
          </div>

          <div class="partnerRow">
            <div class="partnerName">
              <b>Max Titanium</b>
              <div class="muted">Nutri√ß√£o esportiva</div>
            </div>
            <button class="btnSecondary" type="button" onclick="abrirLink('https://www.maxtitanium.com.br')">Abrir</button>
          </div>

          <div class="partnerRow">
            <div class="partnerName">
              <b>Nike</b>
              <div class="muted">T√™nis e roupas</div>
            </div>
            <button class="btnSecondary" type="button" onclick="abrirLink('https://www.nike.com.br')">Abrir</button>
          </div>

          <div class="partnerRow">
            <div class="partnerName">
              <b>Adidas</b>
              <div class="muted">Performance e lifestyle</div>
            </div>
            <button class="btnSecondary" type="button" onclick="abrirLink('https://www.adidas.com.br')">Abrir</button>
          </div>

          <div class="partnerRow">
            <div class="partnerName">
              <b>Mercado Livre</b>
              <div class="muted">Acess√≥rios, equipamentos e suplementos</div>
            </div>
            <button class="btnSecondary" type="button" onclick="abrirLink('https://www.mercadolivre.com.br')">Abrir</button>
          </div>

          <div class="partnerRow">
            <div class="partnerName">
              <b>Shopee</b>
              <div class="muted">Produtos fitness com pre√ßo acess√≠vel</div>
            </div>
            <button class="btnSecondary" type="button" onclick="abrirLink('https://shopee.com.br')">Abrir</button>
          </div>
        </div>
      </div>
    </section>

    <!-- PREMIUM -->
    <section id="viewPremium" class="screen">
      <div class="h1">PREMIUM</div>

      <div class="card">
        <div class="label" style="margin-top:0">Assinatura</div>
        <div class="hint">Pre√ßo mensal. O pagamento abre no Mercado Pago.</div>

        <div class="card" style="margin-top:12px">
          <div class="label" style="margin-top:0">Plano</div>
          <div style="font-weight:1000; font-size:18px">Elite Premium ‚Äî <span id="premiumPriceTxt">R$ 29,90/m√™s</span></div>
          <div class="muted" style="margin-top:8px">
            Benef√≠cios: dietas ilimitadas, treinos completos, convites com recompensa, parceiros e novidades.
          </div>
        </div>

        <button id="btnPremium" class="btnOrange" type="button" onclick="openCheckout()">CONFIRMAR</button>
        <div class="hint" style="margin-top:10px">Ambiente seguro ‚Ä¢ SSL</div>
      </div>
    </section>

    <!-- CONVITES -->
    <section id="viewConvites" class="screen">
      <div class="h1">CONVITES</div>

      <div class="card">
        <div class="hint">
          Convide amigos e ganhe: <b>R$ 5</b> por cada pessoa que assinar usando seu link.
          Ao atingir <b>R$ 50</b>, voc√™ pode solicitar saque (demo) e ainda ganha <b>1 m√™s gr√°tis</b>.
        </div>

        <div style="margin-top:12px" class="card">
          <div class="label" style="margin-top:0">Seu c√≥digo</div>
          <div id="myCode" style="font-weight:1000; font-size:18px">‚Äî</div>

          <div class="label" style="margin-top:12px">Seu link</div>
          <div id="myLink" class="muted" style="word-break:break-all">‚Äî</div>

          <div class="label" style="margin-top:12px">Saldo (demo)</div>
          <div id="balTxt" style="font-weight:1000; font-size:18px">R$ 0,00</div>
          <div id="progressTxt" class="muted" style="margin-top:6px"></div>

          <div class="miniRow" style="margin-top:12px">
            <button class="miniBtn" type="button" onclick="copyInviteLink()">Copiar link</button>
            <button class="miniBtn" type="button" onclick="shareInvite()">Compartilhar</button>
          </div>

          <div id="saqueBox" style="margin-top:10px; display:none">
            <button class="btn" type="button" onclick="solicitarSaque()">Solicitar saque (Pix) ‚úÖ</button>
            <div id="saqueStatus" class="status" style="display:none"></div>
          </div>

          <!-- bot√µes de teste (pode remover depois) -->
          <div class="miniRow" style="margin-top:10px">
            <button class="miniBtn" type="button" onclick="setBalance(getBalance()+5)">+R$5 (teste)</button>
            <button class="miniBtn" type="button" onclick="setBalance(0)">Zerar (teste)</button>
          </div>
        </div>
      </div>
    </section>

    <!-- SA√öDE -->
    <section id="viewSaude" class="screen">
      <div class="h1">SA√öDE</div>

      <div class="card">
        <div class="hint">
          Conte√∫do educativo. <b>N√£o substitui m√©dico.</b>
          <br><br>
          <b>Sobre anabolizantes/esteroides:</b> podem afetar cora√ß√£o, press√£o, colesterol, f√≠gado, humor e horm√¥nios.
          Se houver sintomas (dor no peito, falta de ar, palpita√ß√£o, desmaio, incha√ßo, pele/olhos amarelados, urina escura),
          <b>procure atendimento imediato</b>.
        </div>

        <div class="meal" style="margin-top:14px">
          <div>
            <div class="title">Exemplos comuns (educativo)</div>
            <p>
              <b>Testosterona (√©steres)</b>: pode aumentar acne, reten√ß√£o, press√£o; risco cardiovascular depende de v√°rios fatores.<br>
              <b>Nandrolona</b>: pode alterar perfil lip√≠dico; poss√≠veis efeitos em libido/humor.<br>
              <b>Oxandrolona</b>: pode impactar colesterol e f√≠gado (especialmente em uso inadequado).<br>
              <b>Stanozolol</b>: maior impacto em colesterol; risco articular/tend√µes e hep√°tico.<br>
              <b>Trembolona</b>: associado a efeitos fortes em sono/ansiedade/press√£o; riscos elevados.<br>
              <b>Dianabol (metandrostenolona)</b>: reten√ß√£o e impacto hep√°tico/lip√≠dico.
            </p>
          </div>
        </div>

        <div class="meal">
          <div>
            <div class="title">Cuidados e redu√ß√£o de risco</div>
            <p>
              Evite misturar subst√¢ncias; n√£o use sem acompanhamento. Fa√ßa check-ups com profissional.
              Priorize sono, dieta com fibras, hidrata√ß√£o, e monitoramento de press√£o.
              Exames comuns: hemograma, lipidograma, glicemia, TGO/TGP, creatinina, horm√¥nios (com m√©dico).
            </p>
          </div>
        </div>

        <button class="btnSecondary" type="button" onclick="abrirLink('https://bvsms.saude.gov.br/')">
          Ler mais (fontes oficiais de sa√∫de)
        </button>
      </div>
    </section>
  </div>

  <!-- NAVBAR (aparece s√≥ ap√≥s entrar no app) -->
  <div class="nav hidden" id="navBar">
    <div class="navInner">
      <button class="navBtn active" data-view="cadastro" type="button">CADASTRO</button>
      <button class="navBtn" data-view="dieta" type="button">DIETA</button>
      <button class="navBtn" data-view="treino" type="button">TREINO</button>
      <button class="navBtn" data-view="loja" type="button">LOJA</button>
      <button class="navBtn" data-view="parceiros" type="button">PARCEIROS</button>
      <button class="navBtn" data-view="premium" type="button">PREMIUM</button>
      <button class="navBtn" data-view="saude" type="button">SA√öDE</button>
      <button class="navBtn" data-view="convites" type="button">CONVITES</button>
    </div>
  </div>

  <button id="btnTop" onclick="scrollToTop()">‚Üë</button>

  <!-- MODAL AUTH -->
  <div class="modalBack" id="authModalBack">
    <div class="modal">
      <div class="closeRow">
        <h3 style="margin:0">Entrar / Criar conta</h3>
        <button class="xBtn" onclick="closeAuthModal()">Fechar</button>
      </div>

      <div class="hint" style="margin-top:8px">
        Para login Google/Email funcionar, voc√™ precisa configurar Firebase (√© r√°pido).
        Se n√£o quiser agora, use ‚ÄúConvidado‚Äù.
      </div>

      <div style="margin-top:12px">
        <button class="btn" type="button" onclick="loginGoogle()">Entrar com Google</button>
      </div>

      <div class="label">Email</div>
      <input id="authEmail" inputmode="email" placeholder="email@exemplo.com">

      <div class="label">Senha</div>
      <input id="authPass" type="password" placeholder="********">

      <div class="miniRow" style="margin-top:12px">
        <button class="miniBtn" type="button" onclick="loginEmail()">Entrar</button>
        <button class="miniBtn" type="button" onclick="signupEmail()">Criar conta</button>
      </div>

      <button class="btnSecondary" type="button" onclick="enterGuest()">Entrar como convidado</button>

      <div id="authMsg" class="status" style="display:none"></div>

      <div style="margin-top:12px; border-top:1px solid rgba(255,255,255,.08); padding-top:12px">
        <button class="btnSecondary" type="button" onclick="logout()">Sair da conta</button>
      </div>
    </div>
  </div>

  <!-- Firebase (opcional) - pode deixar, mesmo sem configurar n√£o quebra -->
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script>

  <script>
    /***********************
     * 0) PWA / SERVICE WORKER
     ***********************/
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("./service-worker.js").catch(()=>{});
    }

    /***********************
     * 1) CONFIG GERAL
     ***********************/
    const PREMIUM_PRICE = 29.90;
    const PREMIUM_CHECKOUT_URL = "https://mpago.la/2BRjpaP";
    function openCheckout(){ window.open(PREMIUM_CHECKOUT_URL, "_blank"); }
    window.openCheckout = openCheckout;

    const $ = (id)=> document.getElementById(id);
    function abrirLink(url){ window.open(url, "_blank"); }
    window.abrirLink = abrirLink;

    function openYT(query){
      const q = encodeURIComponent(query);
      window.open(`https://www.youtube.com/results?search_query=${q}`, "_blank");
    }

    function escapeHtml(s){
      return String(s).replace(/[&<>"]/g, m => ({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;" }[m]));
    }

    /***********************
     * 2) STORAGE KEYS
     ***********************/
    const KEY_PROFILE = "checkprato_profile_v2";
    const KEY_AVATAR  = "checkprato_avatar_v1";   // dataURL
    const KEY_PLATE_LAST = "checkprato_plate_last_v2"; // dataURL
    const KEY_PLATE_HISTORY = "checkprato_plate_history_v1"; // array {hash,ts,desc}
    const KEY_DIETA = "checkprato_dieta_v2";
    const KEY_TREINO = "checkprato_treino_v2";
    const KEY_INV_CODE = "checkprato_inv_code_v1";
    const KEY_BAL = "checkprato_inv_balance_v1";
    const KEY_GUEST = "checkprato_guest_v1"; // "1" se convidado

    /***********************
     * 3) FIREBASE (OPCIONAL)
     * - Preencha o config abaixo quando criar projeto no Firebase.
     * - Se n√£o preencher, o app funciona local (guest/localStorage).
     ***********************/
    const FIREBASE_CONFIG = {
      // üî• COLE AQUI SUAS CHAVES DO FIREBASE:
      // apiKey: "....",
      // authDomain: "....firebaseapp.com",
      // projectId: "....",
      // storageBucket: "....appspot.com",
      // messagingSenderId: "....",
      // appId: "...."
    };

    let firebaseEnabled = false;
    let auth = null;
    let db = null;
    let currentUser = null;

    function initFirebaseIfPossible(){
      try{
        const hasKeys = FIREBASE_CONFIG && FIREBASE_CONFIG.apiKey && FIREBASE_CONFIG.projectId;
        if(!hasKeys) return;
        firebase.initializeApp(FIREBASE_CONFIG);
        auth = firebase.auth();
        db = firebase.firestore();
        firebaseEnabled = true;

        auth.onAuthStateChanged(async (user)=>{
          currentUser = user || null;
          if(currentUser){
            localStorage.removeItem(KEY_GUEST);
            setAuthBadge(`Logado: ${currentUser.email || "Google"}`);
            await syncFromCloud();
            enterApp();
          }else{
            if(!localStorage.getItem(KEY_GUEST)){
              setAuthBadge("Modo: Local");
              // mant√©m na welcome se n√£o for guest
              showOnly("viewWelcome");
              $("navBar").classList.add("hidden");
            }
          }
        });
      }catch(e){
        console.log("Firebase init error:", e);
      }
    }

    function setAuthBadge(txt){
      const el = $("authTxt");
      if(el) el.textContent = txt;
    }

    /***********************
     * 4) AUTH UI
     ***********************/
    function openAuthModal(){ $("authModalBack").style.display = "block"; }
    function closeAuthModal(){ $("authModalBack").style.display = "none"; hideAuthMsg(); }
    window.openAuthModal = openAuthModal;
    window.closeAuthModal = closeAuthModal;

    function showAuthMsg(text){
      const box = $("authMsg");
      box.style.display = "block";
      box.textContent = text;
    }
    function hideAuthMsg(){
      const box = $("authMsg");
      box.style.display = "none";
      box.textContent = "";
    }

    async function loginGoogle(){
      if(!firebaseEnabled){ showAuthMsg("‚ö†Ô∏è Firebase n√£o configurado. Use Convidado ou configure o FIREBASE_CONFIG."); return; }
      hideAuthMsg();
      try{
        const provider = new firebase.auth.GoogleAuthProvider();
        await auth.signInWithPopup(provider);
        closeAuthModal();
      }catch(e){
        showAuthMsg("Erro no Google: " + (e.message || e));
      }
    }
    window.loginGoogle = loginGoogle;

    async function loginEmail(){
      if(!firebaseEnabled){ showAuthMsg("‚ö†Ô∏è Firebase n√£o configurado. Use Convidado ou configure o FIREBASE_CONFIG."); return; }
      hideAuthMsg();
      const email = ($("authEmail").value||"").trim();
      const pass  = $("authPass").value||"";
      if(!email || !pass){ showAuthMsg("Preencha email e senha."); return; }
      try{
        await auth.signInWithEmailAndPassword(email, pass);
        closeAuthModal();
      }catch(e){
        showAuthMsg("Erro: " + (e.message || e));
      }
    }
    window.loginEmail = loginEmail;

    async function signupEmail(){
      if(!firebaseEnabled){ showAuthMsg("‚ö†Ô∏è Firebase n√£o configurado. Use Convidado ou configure o FIREBASE_CONFIG."); return; }
      hideAuthMsg();
      const email = ($("authEmail").value||"").trim();
      const pass  = $("authPass").value||"";
      if(!email || !pass){ showAuthMsg("Preencha email e senha."); return; }
      if(pass.length < 6){ showAuthMsg("Senha precisa ter pelo menos 6 caracteres."); return; }
      try{
        await auth.createUserWithEmailAndPassword(email, pass);
        closeAuthModal();
      }catch(e){
        showAuthMsg("Erro: " + (e.message || e));
      }
    }
    window.signupEmail = signupEmail;

    async function logout(){
      try{
        if(firebaseEnabled && auth){
          await auth.signOut();
        }
        currentUser = null;
        localStorage.removeItem(KEY_GUEST);
        setAuthBadge("Modo: Local");
        showOnly("viewWelcome");
        $("navBar").classList.add("hidden");
      }catch(e){
        showAuthMsg("Erro ao sair: " + (e.message || e));
      }
    }
    window.logout = logout;

    function enterGuest(){
      localStorage.setItem(KEY_GUEST, "1");
      setAuthBadge("Modo: Convidado");
      closeAuthModal();
      enterApp();
    }
    window.enterGuest = enterGuest;

    /***********************
     * 5) NAVEGA√á√ÉO ENTRE TELAS
     ***********************/
    function showOnly(id){
      document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
      const el = document.getElementById(id);
      if(el) el.classList.add("active");
      window.scrollTo({ top:0, behavior:"instant" });
      updateTopBtn();
    }

    function enterApp(){
      $("navBar").classList.remove("hidden");
      switchView("cadastro");
      aplicarCadastroNaTela();
      buildSportsChips();
      wirePlateInput();
      loadLastPlate();
      renderDieta(carregarDieta());
      renderTreino(carregarTreino());
      renderInviteUI();
      applyAvatarFromStorage();
      updatePremiumText();
      maybeShowSaque();
    }

    function switchView(view){
      // remove active
      document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
      document.querySelectorAll(".navBtn").forEach(b => b.classList.remove("active"));

      const map = {
        welcome:"viewWelcome",
        cadastro:"viewCadastro",
        dieta:"viewDieta",
        treino:"viewTreino",
        loja:"viewLoja",
        parceiros:"viewParceiros",
        premium:"viewPremium",
        convites:"viewConvites",
        saude:"viewSaude",
      };
      const id = map[view];
      if(id){
        const el = document.getElementById(id);
        if(el) el.classList.add("active");
      }
      const btn = document.querySelector(`.navBtn[data-view="${view}"]`);
      if(btn) btn.classList.add("active");

      updateTopBtn();
    }
    window.switchView = switchView;

    function wireNav(){
      document.querySelectorAll(".navBtn").forEach(btn=>{
        btn.addEventListener("click", ()=> switchView(btn.dataset.view));
      });
    }

    /***********************
     * 6) ESPORTES
     ***********************/
    const ESPORTES = [
      "Muscula√ß√£o","Futebol","Corrida","Crossfit","Ciclismo","Nata√ß√£o",
      "Luta","Basquete","V√¥lei","Yoga","Pilates","Caminhada"
    ];
    let selectedSports = new Set();

    function buildSportsChips(){
      const box = $("chipsEsportes");
      if(!box) return;
      box.innerHTML = "";
      ESPORTES.forEach(name=>{
        const div = document.createElement("div");
        div.className = "chip";
        div.textContent = name;
        div.addEventListener("click", ()=>{
          if(selectedSports.has(name)) selectedSports.delete(name);
          else selectedSports.add(name);
          div.classList.toggle("on");
        });
        box.appendChild(div);
      });

      // se tiver perfil salvo, marca
      const p = carregarCadastro();
      if(p && Array.isArray(p.esportes)){
        selectedSports = new Set(p.esportes);
        [...box.querySelectorAll(".chip")].forEach(ch=>{
          if(selectedSports.has(ch.textContent)) ch.classList.add("on");
        });
      }
    }

    /***********************
     * 7) PERFIL / CADASTRO (SALVAR)
     ***********************/
    function carregarCadastro(){
      try{ return JSON.parse(localStorage.getItem(KEY_PROFILE) || "null"); }catch{ return null; }
    }

    function aplicarCadastroNaTela(){
      const p = carregarCadastro();
      if(!p) return;
      if($("nome")) $("nome").value = p.nome || "";
      if($("emailPerfil")) $("emailPerfil").value = p.email || "";
      if($("peso")) $("peso").value = p.peso || "";
      if($("altura")) $("altura").value = p.altura || "";
      if($("objetivo")) $("objetivo").value = p.objetivo || "";
      if($("nivel")) $("nivel").value = p.nivel || "";
      if($("condicao")) $("condicao").value = p.condicao || "";
      if($("restricao")) $("restricao").value = p.restricao || "";
      if($("termo")) $("termo").checked = !!p.termo;
    }

    async function salvarCadastro(){
      const termo = $("termo")?.checked;
      if(!termo){
        alert("Marque 'Aceito o termo' para salvar.");
        return;
      }

      const perfil = {
        nome: ($("nome")?.value || "").trim(),
        email: ($("emailPerfil")?.value || "").trim(),
        peso: ($("peso")?.value || "").trim(),
        altura: ($("altura")?.value || "").trim(),
        objetivo: $("objetivo")?.value || "",
        nivel: $("nivel")?.value || "",
        condicao: $("condicao")?.value || "",
        restricao: $("restricao")?.value || "",
        esportes: Array.from(selectedSports),
        termo: true,
        updatedAt: Date.now()
      };

      localStorage.setItem(KEY_PROFILE, JSON.stringify(perfil));

      // salva na nuvem se logado
      if(firebaseEnabled && currentUser && db){
        try{
          await db.collection("users").doc(currentUser.uid).set({
            profile: perfil,
            avatar: localStorage.getItem(KEY_AVATAR) || null,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
          }, { merge:true });
        }catch(e){
          console.log("cloud save error:", e);
        }
      }

      const out = $("outCadastro");
      if(out){
        out.style.display = "block";
        out.textContent = "‚úÖ Cadastro salvo.";
      }
    }
    window.salvarCadastro = salvarCadastro;

    async function limparCadastro(){
      localStorage.removeItem(KEY_PROFILE);
      ["nome","emailPerfil","peso","altura"].forEach(id=>{ if($(id)) $(id).value=""; });
      ["objetivo","nivel","condicao","restricao"].forEach(id=>{ if($(id)) $(id).value=""; });
      if($("termo")) $("termo").checked = false;
      selectedSports = new Set();
      buildSportsChips();
      const out = $("outCadastro");
      if(out){ out.style.display="block"; out.textContent="üßπ Cadastro limpo."; }

      // opcional: limpar na nuvem
      if(firebaseEnabled && currentUser && db){
        try{
          await db.collection("users").doc(currentUser.uid).set({ profile: null }, { merge:true });
        }catch(e){}
      }
    }
    window.limparCadastro = limparCadastro;

    /***********************
     * 8) AVATAR (FOTO PERFIL)
     ***********************/
    function pickAvatar(){
      $("avatarFile").click();
    }
    window.pickAvatar = pickAvatar;

    $("avatarFile").addEventListener("change", async ()=>{
      const file = $("avatarFile").files?.[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = async ()=>{
        const dataUrl = String(reader.result || "");
        localStorage.setItem(KEY_AVATAR, dataUrl);
        applyAvatarFromStorage();

        // salva na nuvem se logado
        if(firebaseEnabled && currentUser && db){
          try{
            await db.collection("users").doc(currentUser.uid).set({
              avatar: dataUrl,
              updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            }, { merge:true });
          }catch(e){ console.log(e); }
        }
      };
      reader.readAsDataURL(file);
    });

    function applyAvatarFromStorage(){
      const dataUrl = localStorage.getItem(KEY_AVATAR);
      const img = $("avatarImg");
      const fb = $("avatarFallback");
      const logoBox = $("logoBox");

      if(dataUrl){
        img.src = dataUrl;
        img.style.display = "block";
        fb.style.display = "none";

        // logo tamb√©m
        logoBox.innerHTML = `<img src="${dataUrl}" alt="E">`;
      }else{
        img.style.display = "none";
        fb.style.display = "flex";
        logoBox.textContent = "E";
      }
    }

    /***********************
     * 9) PRATO (IA) + HIST√ìRICO / ANTI-REPETI√á√ÉO
     ***********************/
    function wirePlateInput(){
      const btnCam = $("btnCamera");
      const btnGal = $("btnGaleria");
      const fc = $("fileCamera");
      const fg = $("fileGaleria");

      if(btnCam && fc) btnCam.onclick = ()=> fc.click();
      if(btnGal && fg) btnGal.onclick = ()=> fg.click();

      function onFile(file){
        if(!file) return;
        const reader = new FileReader();
        reader.onload = async ()=>{
          const dataUrl = String(reader.result || "");
          localStorage.setItem(KEY_PLATE_LAST, dataUrl);
          showPlate(dataUrl);

          // anti-repeti√ß√£o simples: hash da dataUrl
          const hash = await sha1(dataUrl);
          const hist = loadPlateHistory();
          const already = hist.some(x => x.hash === hash);
          if(already){
            alert("‚ö†Ô∏è Parece que essa mesma foto j√° foi analisada antes (evitar repeti√ß√£o). Se quiser, analise mesmo assim.");
          }
        };
        reader.readAsDataURL(file);
      }

      if(fc) fc.onchange = ()=> onFile(fc.files?.[0]);
      if(fg) fg.onchange = ()=> onFile(fg.files?.[0]);
    }

    function showPlate(dataUrl){
      const box = $("platePreview");
      const img = $("plateImg");
      if(!box || !img) return;
      img.src = dataUrl;
      box.style.display = "block";
    }

    function loadLastPlate(){
      const dataUrl = localStorage.getItem(KEY_PLATE_LAST);
      if(dataUrl) showPlate(dataUrl);
    }

    function loadPlateHistory(){
      try{ return JSON.parse(localStorage.getItem(KEY_PLATE_HISTORY) || "[]"); }catch{ return []; }
    }
    function savePlateHistory(arr){
      localStorage.setItem(KEY_PLATE_HISTORY, JSON.stringify(arr));
    }

    // Endpoint (IA real):
    // - Depois voc√™ cria um backend (Firebase Functions / Cloud Run) que recebe a imagem
    // - Retorna JSON { description: "...", items: [...], calories: 650 }
    const AI_ENDPOINT = ""; // <-- COLE A URL AQUI QUANDO TIVER (ex: https://.../analyze)

    async function analisarPrato(){
      const dataUrl = localStorage.getItem(KEY_PLATE_LAST);
      const out = $("plateResult");
      const confirmBox = $("plateConfirmBox");
      const edit = $("plateEdit");
      if(!out || !confirmBox || !edit) return;

      confirmBox.style.display = "none";
      out.style.display = "block";
      out.textContent = "‚è≥ Analisando...";

      if(!dataUrl){
        out.textContent = "Envie uma foto primeiro.";
        return;
      }

      // tenta IA real
      let result = null;
      try{
        if(AI_ENDPOINT){
          const res = await fetch(AI_ENDPOINT, {
            method:"POST",
            headers:{ "Content-Type":"application/json" },
            body: JSON.stringify({ image: dataUrl })
          });
          if(res.ok){
            result = await res.json();
          }
        }
      }catch(e){
        console.log("AI endpoint error:", e);
      }

      // fallback demo
      if(!result){
        const p = carregarCadastro() || {};
        const objetivo = (p.objetivo || "Manter").toLowerCase();
        let kcal = 650;
        if(objetivo.includes("emag")) kcal = 520;
        if(objetivo.includes("massa")) kcal = 820;

        result = {
          description: `Arroz + prote√≠na (frango/carne) + salada/legumes (estimativa).`,
          calories: kcal,
          items: ["Arroz", "Prote√≠na", "Salada/Legumes"]
        };
      }

      const text = `üß† IA sugeriu: ${result.description}\n\nüî• Estimativa: ~${result.calories} kcal\nüçΩÔ∏è Itens: ${(result.items||[]).join(", ")}`;
      out.textContent = text;

      edit.value = text;
      confirmBox.style.display = "block";
    }
    window.analisarPrato = analisarPrato;

    function refazerAnalise(){
      $("plateConfirmBox").style.display = "none";
      $("plateResult").style.display = "none";
      $("plateEdit").value = "";
      analisarPrato();
    }
    window.refazerAnalise = refazerAnalise;

    async function confirmarPrato(){
      const edit = $("plateEdit");
      const out = $("plateResult");
      const dataUrl = localStorage.getItem(KEY_PLATE_LAST);
      if(!edit || !out || !dataUrl) return;

      const desc = (edit.value||"").trim();
      if(!desc){
        alert("Escreva/edite a descri√ß√£o antes de confirmar.");
        return;
      }

      const hash = await sha1(dataUrl);
      const hist = loadPlateHistory();
      hist.unshift({ hash, ts: Date.now(), desc });
      // limita hist√≥rico
      while(hist.length > 30) hist.pop();
      savePlateHistory(hist);

      // salva na nuvem (se logado)
      if(firebaseEnabled && currentUser && db){
        try{
          await db.collection("users").doc(currentUser.uid).set({
            plateHistory: hist,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
          }, { merge:true });
        }catch(e){ console.log(e); }
      }

      out.style.display = "block";
      out.textContent = "‚úÖ Prato confirmado e salvo no hist√≥rico.";
      $("plateConfirmBox").style.display = "none";
    }
    window.confirmarPrato = confirmarPrato;

    async function sha1(text){
      const enc = new TextEncoder().encode(text);
      const buf = await crypto.subtle.digest("SHA-1", enc);
      const arr = Array.from(new Uint8Array(buf));
      return arr.map(b=>b.toString(16).padStart(2,"0")).join("");
    }

    /***********************
     * 10) DIETA (GERAR + REFAZER)
     ***********************/
    const DIETAS_BASE = [
      [
        {t:"Caf√© da manh√£", d:"Omelete de 2 ovos com espinafre + 1 fatia de p√£o integral.", k:350},
        {t:"Lanche da manh√£", d:"Mix de castanhas + 1 ma√ß√£.", k:180},
        {t:"Almo√ßo", d:"Frango grelhado + arroz integral + feij√£o + salada.", k:550},
        {t:"Lanche da tarde", d:"Iogurte natural + 1 colher de chia.", k:160},
        {t:"Jantar", d:"Peixe grelhado + legumes + batata-doce.", k:480},
      ],
      [
        {t:"Caf√© da manh√£", d:"3 ovos + aveia + banana.", k:550},
        {t:"Almo√ßo", d:"Arroz integral + feij√£o + frango + br√≥colis.", k:800},
        {t:"Jantar", d:"Macarr√£o integral + patinho + molho de tomate.", k:750},
        {t:"Ceia", d:"Iogurte + granola.", k:300},
      ],
      [
        {t:"Caf√© da manh√£", d:"Tapioca com queijo + caf√© sem a√ß√∫car.", k:420},
        {t:"Almo√ßo", d:"Carne magra + mandioca + salada.", k:720},
        {t:"Jantar", d:"Omelete + legumes.", k:460},
      ]
    ];

    function carregarDieta(){
      try{ return JSON.parse(localStorage.getItem(KEY_DIETA) || "null"); }catch{ return null; }
    }
    function salvarDieta(d){
      localStorage.setItem(KEY_DIETA, JSON.stringify(d));
    }

    function gerarDieta(){
      const p = carregarCadastro() || {};
      const objetivo = (p.objetivo || "Manter").toLowerCase();
      let idx = Math.floor(Math.random()*DIETAS_BASE.length);

      // heur√≠stica simples
      if(objetivo.includes("massa")) idx = 1;
      if(objetivo.includes("emag")) idx = 0;

      const d = DIETAS_BASE[idx];
      salvarDieta(d);
      renderDieta(d);

      // nuvem
      cloudMerge({ dieta: d });
    }
    window.gerarDieta = gerarDieta;

    function refazerDieta(){
      // s√≥ gera outra diferente
      const cur = carregarDieta();
      let d = null;
      for(let i=0;i<5;i++){
        const pick = DIETAS_BASE[Math.floor(Math.random()*DIETAS_BASE.length)];
        if(JSON.stringify(pick) !== JSON.stringify(cur)){ d = pick; break; }
      }
      if(!d) d = DIETAS_BASE[Math.floor(Math.random()*DIETAS_BASE.length)];
      salvarDieta(d);
      renderDieta(d);
      cloudMerge({ dieta: d });
    }
    window.refazerDieta = refazerDieta;

    function renderDieta(d){
      const box = $("dietaBox");
      if(!box) return;
      box.innerHTML = "";
      if(!d){
        const s = document.createElement("div");
        s.className="status";
        s.textContent="Gere uma dieta para aparecer aqui.";
        box.appendChild(s);
        return;
      }
      d.forEach(m=>{
        const div = document.createElement("div");
        div.className="meal";
        div.innerHTML = `
          <div>
            <div class="title">${escapeHtml(m.t)}</div>
            <p>${escapeHtml(m.d)}</p>
          </div>
          <div class="kcal">${Number(m.k||0)}<br/>kcal</div>
        `;
        box.appendChild(div);
      });
    }

    /***********************
     * 11) TREINO
     ***********************/
    const TREINOS = {
      "Academia": [
        ["Segunda", ["Desenvolvimento com halteres","Agachamento livre","Flex√£o de bra√ßos"]],
        ["Quarta", ["Supino reto","Remada curvada","Eleva√ß√£o lateral"]],
        ["Sexta", ["Levantamento terra","Puxada na barra","Abdominal prancha"]],
      ],
      "Corrida": [
        ["Segunda", ["Corrida leve 30 min","Mobilidade de quadril"]],
        ["Quarta", ["Tiros 8x 200m","Alongamento"]],
        ["Sexta", ["Corrida moderada 40 min","Fortalecimento core"]],
      ],
      "Muay Thai":[
        ["Ter√ßa", ["Sombra 10 min","Chutes b√°sicos","Combina√ß√µes 1-2"]],
        ["Quinta", ["Manopla (drills)","Defesas","Condicionamento"]],
        ["S√°bado", ["T√©cnica clinch","Sequ√™ncias","Alongamento"]],
      ],
      "Futebol":[
        ["Segunda", ["Arranque e velocidade","Controle de bola","Finaliza√ß√£o"]],
        ["Quarta", ["Agilidade com cones","Passe e dom√≠nio","Resist√™ncia"]],
        ["Sexta", ["Jogo reduzido","Alongamento"]],
      ],
      "Basquete":[
        ["Ter√ßa", ["Drible (fundamentos)","Arremessos","Pliometria"]],
        ["Quinta", ["Defesa lateral","Bandejas","Condicionamento"]],
        ["S√°bado", ["Treino de jogo","Alongamento"]],
      ]
    };

    function carregarTreino(){
      try{ return JSON.parse(localStorage.getItem(KEY_TREINO) || "null"); }catch{ return null; }
    }
    function salvarTreino(t){
      localStorage.setItem(KEY_TREINO, JSON.stringify(t));
    }

    function gerarTreino(){
      const tema = $("temaTreino")?.value || "Academia";
      const intensidade = $("intTreino")?.value || "Moderado";
      const base = TREINOS[tema] || TREINOS["Academia"];

      const plano = { tema, intensidade, dias: base, createdAt: Date.now() };
      salvarTreino(plano);
      renderTreino(plano);

      const out = $("outTreino");
      if(out){
        out.style.display="block";
        out.textContent = `‚úÖ Treino salvo: ${tema} (${intensidade}).`;
      }

      cloudMerge({ treino: plano });
    }
    window.gerarTreino = gerarTreino;

    function limparTreino(){
      localStorage.removeItem(KEY_TREINO);
      if($("treinoSemana")) $("treinoSemana").innerHTML = "";
      const out = $("outTreino");
      if(out){ out.style.display="block"; out.textContent="üßπ Treino removido."; }

      cloudMerge({ treino: null });
    }
    window.limparTreino = limparTreino;

    function renderTreino(t){
      const box = $("treinoSemana");
      if(!box) return;
      box.innerHTML = "";
      if(!t){
        const s = document.createElement("div");
        s.className="status";
        s.textContent="Gere um treino para aparecer aqui.";
        box.appendChild(s);
        return;
      }

      t.dias.forEach(d=>{
        const day = document.createElement("div");
        day.className="dayCard";
        day.innerHTML = `<div class="dayTitle"><span>${escapeHtml(d[0])}</span><span class="muted">${escapeHtml(t.tema)}</span></div>`;
        (d[1]||[]).forEach(ex=>{
          const row = document.createElement("div");
          row.className="exercise";
          const left = document.createElement("div");
          left.innerHTML = `<b>${escapeHtml(ex)}</b><div class="muted" style="font-size:12px; margin-top:4px">${escapeHtml(t.intensidade)}</div>`;
          const btn = document.createElement("button");
          btn.className="ytBtn";
          btn.textContent="Ver t√©cnica";
          btn.addEventListener("click", ()=> openYT(`${ex} como fazer`));
          row.appendChild(left);
          row.appendChild(btn);
          day.appendChild(row);
        });
        box.appendChild(day);
      });
    }

    /***********************
     * 12) CONVITES + SAQUE
     ***********************/
    function getOrCreateInviteCode(){
      let code = localStorage.getItem(KEY_INV_CODE);
      if(code) return code;
      code = "ELITE-" + Math.random().toString(16).slice(2,8).toUpperCase();
      localStorage.setItem(KEY_INV_CODE, code);
      return code;
    }
    function getMyInviteLink(){
      const code = getOrCreateInviteCode();
      const url = new URL(location.href);
      url.searchParams.set("ref", code);
      return url.toString();
    }

    function getBalance(){ return Number(localStorage.getItem(KEY_BAL) || "0"); }
    function setBalance(v){
      localStorage.setItem(KEY_BAL, String(v));
      renderInviteUI();
      maybeShowSaque();
      cloudMerge({ balance: v });
    }
    window.getBalance = getBalance;
    window.setBalance = setBalance;

    async function copyInviteLink(){
      const link = getMyInviteLink();
      try{
        await navigator.clipboard.writeText(link);
        alert("‚úÖ Link copiado!");
      }catch{
        prompt("Copie o link:", link);
      }
    }
    window.copyInviteLink = copyInviteLink;

    function shareInvite(){
      const link = getMyInviteLink();
      const text = `Baixa o Confira o Prato Elite e usa meu link: ${link}`;
      if(navigator.share){
        navigator.share({ title:"Confira o Prato Elite", text, url: link }).catch(()=>{});
      }else{
        copyInviteLink();
      }
    }
    window.shareInvite = shareInvite;

    function renderInviteUI(){
      const code = getOrCreateInviteCode();
      const link = getMyInviteLink();
      const bal = getBalance();
      const falta = Math.max(0, 50 - bal);

      if($("myCode")) $("myCode").textContent = code;
      if($("myLink")) $("myLink").textContent = link;

      if($("balTxt")){
        $("balTxt").textContent = new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(bal);
      }
      if($("progressTxt")){
        $("progressTxt").textContent = bal >= 50
          ? "‚úÖ Voc√™ atingiu R$ 50! Agora pode solicitar saque (demo)."
          : `Faltam ${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(falta)} para atingir R$ 50.`;
      }
    }

    function maybeShowSaque(){
      const bal = getBalance();
      const box = $("saqueBox");
      if(!box) return;
      box.style.display = bal >= 50 ? "block" : "none";
    }

    function solicitarSaque(){
      const bal = getBalance();
      const status = $("saqueStatus");
      if(!status) return;

      if(bal < 50){
        alert("Ainda n√£o atingiu o m√≠nimo de R$ 50.");
        return;
      }

      // demo: n√£o faz Pix real (precisa backend)
      status.style.display = "block";
      status.textContent = "‚úÖ Solicita√ß√£o registrada (DEMO). Para Pix real, precisa backend + valida√ß√£o.";
    }
    window.solicitarSaque = solicitarSaque;

    /***********************
     * 13) CLOUD SYNC (se logado)
     ***********************/
    async function cloudMerge(payload){
      if(!(firebaseEnabled && currentUser && db)) return;
      try{
        await db.collection("users").doc(currentUser.uid).set({
          data: payload,
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        }, { merge:true });
      }catch(e){}
    }

    async function syncFromCloud(){
      if(!(firebaseEnabled && currentUser && db)) return;
      try{
        const doc = await db.collection("users").doc(currentUser.uid).get();
        if(!doc.exists) return;

        const data = doc.data() || {};
        // perfil
        if(data.profile){
          localStorage.setItem(KEY_PROFILE, JSON.stringify(data.profile));
        }
        if(data.avatar){
          localStorage.setItem(KEY_AVATAR, data.avatar);
        }
        if(data.plateHistory){
          localStorage.setItem(KEY_PLATE_HISTORY, JSON.stringify(data.plateHistory));
        }
        // dados extras (merge)
        if(data.data){
          if("dieta" in data.data) localStorage.setItem(KEY_DIETA, JSON.stringify(data.data.dieta));
          if("treino" in data.data) localStorage.setItem(KEY_TREINO, JSON.stringify(data.data.treino));
          if("balance" in data.data) localStorage.setItem(KEY_BAL, String(data.data.balance));
        }
      }catch(e){
        console.log("sync error:", e);
      }
    }

    /***********************
     * 14) UI: bot√£o topo
     ***********************/
    function scrollToTop(){
      const active = document.querySelector(".screen.active");
      if(active){
        active.scrollIntoView({ behavior:"smooth", block:"start" });
        window.scrollTo({ top: 0, behavior: "smooth" });
      }
    }
    window.scrollToTop = scrollToTop;

    function updateTopBtn(){
      const btn = $("btnTop");
      if(!btn) return;
      btn.style.display = window.scrollY > 300 ? "block" : "none";
    }
    document.addEventListener("scroll", updateTopBtn, { passive:true });

    /***********************
     * 15) PREMIUM TEXTO
     ***********************/
    function updatePremiumText(){
      $("premiumPriceTxt").textContent = `R$ ${PREMIUM_PRICE.toFixed(2).replace(".", ",")}/m√™s`;
      const btn = $("btnPremium");
      if(btn){
        btn.textContent = `CONFIRMAR R$ ${PREMIUM_PRICE.toFixed(2).replace(".", ",")}/M√äS`;
      }
    }

    /***********************
     * 16) INIT
     ***********************/
    function init(){
      wireNav();
      updatePremiumText();
      applyAvatarFromStorage();
      renderInviteUI();
      maybeShowSaque();

      // se j√° estava em guest, entra direto
      if(localStorage.getItem(KEY_GUEST) === "1"){
        setAuthBadge("Modo: Convidado");
        enterApp();
      }else{
        showOnly("viewWelcome");
      }
    }

    initFirebaseIfPossible();
    init();
  </script>
    <!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { 
  getAuth, 
  GoogleAuthProvider, 
  signInWithPopup, 
  signOut, 
  onAuthStateChanged 
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

import { 
  getFirestore, 
  doc, 
  setDoc, 
  getDoc 
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAxzwCdYvhFIAeB4rKuFcaLFKygaTkAmSs",
  authDomain: "checkpratoapp-78232.firebaseapp.com",
  projectId: "checkpratoapp-78232",
  storageBucket: "checkpratoapp-78232.firebasestorage.app",
  messagingSenderId: "1654971003",
  appId: "1:1654971003:web:5e1b12e7f4ac2a4540a0de"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

window.auth = auth;
window.db = db;

const provider = new GoogleAuthProvider();

// LOGIN GOOGLE
window.loginGoogle = async () => {
  try {
    await signInWithPopup(auth, provider);
  } catch(e){
    alert("Erro login Google");
    console.log(e);
  }
};

// LOGOUT
window.logout = () => signOut(auth);

// MONITORAR LOGIN
onAuthStateChanged(auth, (user) => {
  if(user){
    console.log("Logado:", user.email);
  }else{
    console.log("N√£o logado");
  }
});
</script>
</body>
</html>
